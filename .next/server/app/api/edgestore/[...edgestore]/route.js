(()=>{var e={};e.id=8683,e.ids=[8683],e.modules={5662:()=>{},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},19678:(e,t,r)=>{"use strict";e.exports=r(44870)},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},42454:()=>{},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},74075:e=>{"use strict";e.exports=require("zlib")},88549:(e,t,r)=>{"use strict";let a,i,n,s;r.r(t),r.d(t,{patchFetch:()=>a2,routeModule:()=>aX,serverHooks:()=>a1,workAsyncStorage:()=>aQ,workUnitAsyncStorage:()=>a0});var o,d,c,l,u,p,h={};r.r(h),r.d(h,{GET:()=>aY,POST:()=>aY});var f=r(19678),m=r(81303),y=r(46862);!function(e){e.assertEqual=e=>e,e.assertIs=function(e){},e.assertNever=function(e){throw Error()},e.arrayToEnum=e=>{let t={};for(let r of e)t[r]=r;return t},e.getValidEnumValues=t=>{let r=e.objectKeys(t).filter(e=>"number"!=typeof t[t[e]]),a={};for(let e of r)a[e]=t[e];return e.objectValues(a)},e.objectValues=t=>e.objectKeys(t).map(function(e){return t[e]}),e.objectKeys="function"==typeof Object.keys?e=>Object.keys(e):e=>{let t=[];for(let r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.push(r);return t},e.find=(e,t)=>{for(let r of e)if(t(r))return r},e.isInteger="function"==typeof Number.isInteger?e=>Number.isInteger(e):e=>"number"==typeof e&&isFinite(e)&&Math.floor(e)===e,e.joinValues=function(e,t=" | "){return e.map(e=>"string"==typeof e?`'${e}'`:e).join(t)},e.jsonStringifyReplacer=(e,t)=>"bigint"==typeof t?t.toString():t}(o||(o={})),(d||(d={})).mergeShapes=(e,t)=>({...e,...t});let g=o.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),_=e=>{switch(typeof e){case"undefined":return g.undefined;case"string":return g.string;case"number":return isNaN(e)?g.nan:g.number;case"boolean":return g.boolean;case"function":return g.function;case"bigint":return g.bigint;case"symbol":return g.symbol;case"object":if(Array.isArray(e))return g.array;if(null===e)return g.null;if(e.then&&"function"==typeof e.then&&e.catch&&"function"==typeof e.catch)return g.promise;if("undefined"!=typeof Map&&e instanceof Map)return g.map;if("undefined"!=typeof Set&&e instanceof Set)return g.set;if("undefined"!=typeof Date&&e instanceof Date)return g.date;return g.object;default:return g.unknown}},v=o.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);class w extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=e=>{this.issues=[...this.issues,e]},this.addIssues=(e=[])=>{this.issues=[...this.issues,...e]};let t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}format(e){let t=e||function(e){return e.message},r={_errors:[]},a=e=>{for(let i of e.issues)if("invalid_union"===i.code)i.unionErrors.map(a);else if("invalid_return_type"===i.code)a(i.returnTypeError);else if("invalid_arguments"===i.code)a(i.argumentsError);else if(0===i.path.length)r._errors.push(t(i));else{let e=r,a=0;for(;a<i.path.length;){let r=i.path[a];a===i.path.length-1?(e[r]=e[r]||{_errors:[]},e[r]._errors.push(t(i))):e[r]=e[r]||{_errors:[]},e=e[r],a++}}};return a(this),r}static assert(e){if(!(e instanceof w))throw Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,o.jsonStringifyReplacer,2)}get isEmpty(){return 0===this.issues.length}flatten(e=e=>e.message){let t={},r=[];for(let a of this.issues)a.path.length>0?(t[a.path[0]]=t[a.path[0]]||[],t[a.path[0]].push(e(a))):r.push(e(a));return{formErrors:r,fieldErrors:t}}get formErrors(){return this.flatten()}}w.create=e=>new w(e);let E=(e,t)=>{let r;switch(e.code){case v.invalid_type:r=e.received===g.undefined?"Required":`Expected ${e.expected}, received ${e.received}`;break;case v.invalid_literal:r=`Invalid literal value, expected ${JSON.stringify(e.expected,o.jsonStringifyReplacer)}`;break;case v.unrecognized_keys:r=`Unrecognized key(s) in object: ${o.joinValues(e.keys,", ")}`;break;case v.invalid_union:r="Invalid input";break;case v.invalid_union_discriminator:r=`Invalid discriminator value. Expected ${o.joinValues(e.options)}`;break;case v.invalid_enum_value:r=`Invalid enum value. Expected ${o.joinValues(e.options)}, received '${e.received}'`;break;case v.invalid_arguments:r="Invalid function arguments";break;case v.invalid_return_type:r="Invalid function return type";break;case v.invalid_date:r="Invalid date";break;case v.invalid_string:"object"==typeof e.validation?"includes"in e.validation?(r=`Invalid input: must include "${e.validation.includes}"`,"number"==typeof e.validation.position&&(r=`${r} at one or more positions greater than or equal to ${e.validation.position}`)):"startsWith"in e.validation?r=`Invalid input: must start with "${e.validation.startsWith}"`:"endsWith"in e.validation?r=`Invalid input: must end with "${e.validation.endsWith}"`:o.assertNever(e.validation):r="regex"!==e.validation?`Invalid ${e.validation}`:"Invalid";break;case v.too_small:r="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at least":"more than"} ${e.minimum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at least":"over"} ${e.minimum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:"date"===e.type?`Date must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(e.minimum))}`:"Invalid input";break;case v.too_big:r="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at most":"less than"} ${e.maximum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at most":"under"} ${e.maximum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"bigint"===e.type?`BigInt must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"date"===e.type?`Date must be ${e.exact?"exactly":e.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(e.maximum))}`:"Invalid input";break;case v.custom:r="Invalid input";break;case v.invalid_intersection_types:r="Intersection results could not be merged";break;case v.not_multiple_of:r=`Number must be a multiple of ${e.multipleOf}`;break;case v.not_finite:r="Number must be finite";break;default:r=t.defaultError,o.assertNever(e)}return{message:r}},b=E;function k(){return b}let x=e=>{let{data:t,path:r,errorMaps:a,issueData:i}=e,n=[...r,...i.path||[]],s={...i,path:n};if(void 0!==i.message)return{...i,path:n,message:i.message};let o="";for(let e of a.filter(e=>!!e).slice().reverse())o=e(s,{data:t,defaultError:o}).message;return{...i,path:n,message:o}};function A(e,t){let r=k(),a=x({issueData:t,data:e.data,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,r,r===E?void 0:E].filter(e=>!!e)});e.common.issues.push(a)}class S{constructor(){this.value="valid"}dirty(){"valid"===this.value&&(this.value="dirty")}abort(){"aborted"!==this.value&&(this.value="aborted")}static mergeArray(e,t){let r=[];for(let a of t){if("aborted"===a.status)return T;"dirty"===a.status&&e.dirty(),r.push(a.value)}return{status:e.value,value:r}}static async mergeObjectAsync(e,t){let r=[];for(let e of t){let t=await e.key,a=await e.value;r.push({key:t,value:a})}return S.mergeObjectSync(e,r)}static mergeObjectSync(e,t){let r={};for(let a of t){let{key:t,value:i}=a;if("aborted"===t.status||"aborted"===i.status)return T;"dirty"===t.status&&e.dirty(),"dirty"===i.status&&e.dirty(),"__proto__"!==t.value&&(void 0!==i.value||a.alwaysSet)&&(r[t.value]=i.value)}return{status:e.value,value:r}}}let T=Object.freeze({status:"aborted"}),O=e=>({status:"dirty",value:e}),C=e=>({status:"valid",value:e}),R=e=>"aborted"===e.status,P=e=>"dirty"===e.status,I=e=>"valid"===e.status,U=e=>"undefined"!=typeof Promise&&e instanceof Promise;function j(e,t,r,a){if("a"===r&&!a)throw TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!a:!t.has(e))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?a:"a"===r?a.call(e):a?a.value:t.get(e)}function Z(e,t,r,a,i){if("m"===a)throw TypeError("Private method is not writable");if("a"===a&&!i)throw TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===a?i.call(e,r):i?i.value=r:t.set(e,r),r}"function"==typeof SuppressedError&&SuppressedError,function(e){e.errToObj=e=>"string"==typeof e?{message:e}:e||{},e.toString=e=>"string"==typeof e?e:null==e?void 0:e.message}(c||(c={}));class N{constructor(e,t,r,a){this._cachedPath=[],this.parent=e,this.data=t,this._path=r,this._key=a}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}let K=(e,t)=>{if(I(t))return{success:!0,data:t.value};if(!e.common.issues.length)throw Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let t=new w(e.common.issues);return this._error=t,this._error}}};function D(e){if(!e)return{};let{errorMap:t,invalid_type_error:r,required_error:a,description:i}=e;if(t&&(r||a))throw Error('Can\'t use "invalid_type_error" or "required_error" in conjunction with custom error map.');return t?{errorMap:t,description:i}:{errorMap:(t,i)=>{var n,s;let{message:o}=e;return"invalid_enum_value"===t.code?{message:null!=o?o:i.defaultError}:void 0===i.data?{message:null!=(n=null!=o?o:a)?n:i.defaultError}:"invalid_type"!==t.code?{message:i.defaultError}:{message:null!=(s=null!=o?o:r)?s:i.defaultError}},description:i}}class H{get description(){return this._def.description}_getType(e){return _(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:_(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new S,ctx:{common:e.parent.common,data:e.data,parsedType:_(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){let t=this._parse(e);if(U(t))throw Error("Synchronous parse encountered promise.");return t}_parseAsync(e){return Promise.resolve(this._parse(e))}parse(e,t){let r=this.safeParse(e,t);if(r.success)return r.data;throw r.error}safeParse(e,t){var r;let a={common:{issues:[],async:null!=(r=null==t?void 0:t.async)&&r,contextualErrorMap:null==t?void 0:t.errorMap},path:(null==t?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:_(e)},i=this._parseSync({data:e,path:a.path,parent:a});return K(a,i)}"~validate"(e){var t,r;let a={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:_(e)};if(!this["~standard"].async)try{let t=this._parseSync({data:e,path:[],parent:a});return I(t)?{value:t.value}:{issues:a.common.issues}}catch(e){(null==(r=null==(t=null==e?void 0:e.message)?void 0:t.toLowerCase())?void 0:r.includes("encountered"))&&(this["~standard"].async=!0),a.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:a}).then(e=>I(e)?{value:e.value}:{issues:a.common.issues})}async parseAsync(e,t){let r=await this.safeParseAsync(e,t);if(r.success)return r.data;throw r.error}async safeParseAsync(e,t){let r={common:{issues:[],contextualErrorMap:null==t?void 0:t.errorMap,async:!0},path:(null==t?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:_(e)},a=this._parse({data:e,path:r.path,parent:r});return K(r,await (U(a)?a:Promise.resolve(a)))}refine(e,t){let r=e=>"string"==typeof t||void 0===t?{message:t}:"function"==typeof t?t(e):t;return this._refinement((t,a)=>{let i=e(t),n=()=>a.addIssue({code:v.custom,...r(t)});return"undefined"!=typeof Promise&&i instanceof Promise?i.then(e=>!!e||(n(),!1)):!!i||(n(),!1)})}refinement(e,t){return this._refinement((r,a)=>!!e(r)||(a.addIssue("function"==typeof t?t(r,a):t),!1))}_refinement(e){return new eU({schema:this,typeName:p.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:e=>this["~validate"](e)}}optional(){return ej.create(this,this._def)}nullable(){return eZ.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return ey.create(this)}promise(){return eI.create(this,this._def)}or(e){return e_.create([this,e],this._def)}and(e){return eE.create(this,e,this._def)}transform(e){return new eU({...D(this._def),schema:this,typeName:p.ZodEffects,effect:{type:"transform",transform:e}})}default(e){return new eN({...D(this._def),innerType:this,defaultValue:"function"==typeof e?e:()=>e,typeName:p.ZodDefault})}brand(){return new eM({typeName:p.ZodBranded,type:this,...D(this._def)})}catch(e){return new eK({...D(this._def),innerType:this,catchValue:"function"==typeof e?e:()=>e,typeName:p.ZodCatch})}describe(e){return new this.constructor({...this._def,description:e})}pipe(e){return e$.create(this,e)}readonly(){return eW.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}let M=/^c[^\s-]{8,}$/i,$=/^[0-9a-z]+$/,W=/^[0-9A-HJKMNP-TV-Z]{26}$/i,L=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,B=/^[a-z0-9_-]{21}$/i,F=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,J=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,z=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,G=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,V=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,q=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,Y=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,X=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,Q=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,ee="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",et=RegExp(`^${ee}$`);function er(e){let t="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return e.precision?t=`${t}\\.\\d{${e.precision}}`:null==e.precision&&(t=`${t}(\\.\\d+)?`),t}function ea(e){let t=`${ee}T${er(e)}`,r=[];return r.push(e.local?"Z?":"Z"),e.offset&&r.push("([+-]\\d{2}:?\\d{2})"),t=`${t}(${r.join("|")})`,RegExp(`^${t}$`)}class ei extends H{_parse(e){var t,r,i,n;let s;if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==g.string){let t=this._getOrReturnCtx(e);return A(t,{code:v.invalid_type,expected:g.string,received:t.parsedType}),T}let d=new S;for(let c of this._def.checks)if("min"===c.kind)e.data.length<c.value&&(A(s=this._getOrReturnCtx(e,s),{code:v.too_small,minimum:c.value,type:"string",inclusive:!0,exact:!1,message:c.message}),d.dirty());else if("max"===c.kind)e.data.length>c.value&&(A(s=this._getOrReturnCtx(e,s),{code:v.too_big,maximum:c.value,type:"string",inclusive:!0,exact:!1,message:c.message}),d.dirty());else if("length"===c.kind){let t=e.data.length>c.value,r=e.data.length<c.value;(t||r)&&(s=this._getOrReturnCtx(e,s),t?A(s,{code:v.too_big,maximum:c.value,type:"string",inclusive:!0,exact:!0,message:c.message}):r&&A(s,{code:v.too_small,minimum:c.value,type:"string",inclusive:!0,exact:!0,message:c.message}),d.dirty())}else if("email"===c.kind)z.test(e.data)||(A(s=this._getOrReturnCtx(e,s),{validation:"email",code:v.invalid_string,message:c.message}),d.dirty());else if("emoji"===c.kind)a||(a=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),a.test(e.data)||(A(s=this._getOrReturnCtx(e,s),{validation:"emoji",code:v.invalid_string,message:c.message}),d.dirty());else if("uuid"===c.kind)L.test(e.data)||(A(s=this._getOrReturnCtx(e,s),{validation:"uuid",code:v.invalid_string,message:c.message}),d.dirty());else if("nanoid"===c.kind)B.test(e.data)||(A(s=this._getOrReturnCtx(e,s),{validation:"nanoid",code:v.invalid_string,message:c.message}),d.dirty());else if("cuid"===c.kind)M.test(e.data)||(A(s=this._getOrReturnCtx(e,s),{validation:"cuid",code:v.invalid_string,message:c.message}),d.dirty());else if("cuid2"===c.kind)$.test(e.data)||(A(s=this._getOrReturnCtx(e,s),{validation:"cuid2",code:v.invalid_string,message:c.message}),d.dirty());else if("ulid"===c.kind)W.test(e.data)||(A(s=this._getOrReturnCtx(e,s),{validation:"ulid",code:v.invalid_string,message:c.message}),d.dirty());else if("url"===c.kind)try{new URL(e.data)}catch(t){A(s=this._getOrReturnCtx(e,s),{validation:"url",code:v.invalid_string,message:c.message}),d.dirty()}else"regex"===c.kind?(c.regex.lastIndex=0,c.regex.test(e.data)||(A(s=this._getOrReturnCtx(e,s),{validation:"regex",code:v.invalid_string,message:c.message}),d.dirty())):"trim"===c.kind?e.data=e.data.trim():"includes"===c.kind?e.data.includes(c.value,c.position)||(A(s=this._getOrReturnCtx(e,s),{code:v.invalid_string,validation:{includes:c.value,position:c.position},message:c.message}),d.dirty()):"toLowerCase"===c.kind?e.data=e.data.toLowerCase():"toUpperCase"===c.kind?e.data=e.data.toUpperCase():"startsWith"===c.kind?e.data.startsWith(c.value)||(A(s=this._getOrReturnCtx(e,s),{code:v.invalid_string,validation:{startsWith:c.value},message:c.message}),d.dirty()):"endsWith"===c.kind?e.data.endsWith(c.value)||(A(s=this._getOrReturnCtx(e,s),{code:v.invalid_string,validation:{endsWith:c.value},message:c.message}),d.dirty()):"datetime"===c.kind?ea(c).test(e.data)||(A(s=this._getOrReturnCtx(e,s),{code:v.invalid_string,validation:"datetime",message:c.message}),d.dirty()):"date"===c.kind?et.test(e.data)||(A(s=this._getOrReturnCtx(e,s),{code:v.invalid_string,validation:"date",message:c.message}),d.dirty()):"time"===c.kind?RegExp(`^${er(c)}$`).test(e.data)||(A(s=this._getOrReturnCtx(e,s),{code:v.invalid_string,validation:"time",message:c.message}),d.dirty()):"duration"===c.kind?J.test(e.data)||(A(s=this._getOrReturnCtx(e,s),{validation:"duration",code:v.invalid_string,message:c.message}),d.dirty()):"ip"===c.kind?(t=e.data,!(("v4"===(r=c.version)||!r)&&G.test(t)||("v6"===r||!r)&&q.test(t))&&1&&(A(s=this._getOrReturnCtx(e,s),{validation:"ip",code:v.invalid_string,message:c.message}),d.dirty())):"jwt"===c.kind?!function(e,t){if(!F.test(e))return!1;try{let[r]=e.split("."),a=r.replace(/-/g,"+").replace(/_/g,"/").padEnd(r.length+(4-r.length%4)%4,"="),i=JSON.parse(atob(a));if("object"!=typeof i||null===i||!i.typ||!i.alg||t&&i.alg!==t)return!1;return!0}catch(e){return!1}}(e.data,c.alg)&&(A(s=this._getOrReturnCtx(e,s),{validation:"jwt",code:v.invalid_string,message:c.message}),d.dirty()):"cidr"===c.kind?(i=e.data,!(("v4"===(n=c.version)||!n)&&V.test(i)||("v6"===n||!n)&&Y.test(i))&&1&&(A(s=this._getOrReturnCtx(e,s),{validation:"cidr",code:v.invalid_string,message:c.message}),d.dirty())):"base64"===c.kind?X.test(e.data)||(A(s=this._getOrReturnCtx(e,s),{validation:"base64",code:v.invalid_string,message:c.message}),d.dirty()):"base64url"===c.kind?Q.test(e.data)||(A(s=this._getOrReturnCtx(e,s),{validation:"base64url",code:v.invalid_string,message:c.message}),d.dirty()):o.assertNever(c);return{status:d.value,value:e.data}}_regex(e,t,r){return this.refinement(t=>e.test(t),{validation:t,code:v.invalid_string,...c.errToObj(r)})}_addCheck(e){return new ei({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...c.errToObj(e)})}url(e){return this._addCheck({kind:"url",...c.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...c.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...c.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...c.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...c.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...c.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...c.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...c.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...c.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...c.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...c.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...c.errToObj(e)})}datetime(e){var t,r;return"string"==typeof e?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:void 0===(null==e?void 0:e.precision)?null:null==e?void 0:e.precision,offset:null!=(t=null==e?void 0:e.offset)&&t,local:null!=(r=null==e?void 0:e.local)&&r,...c.errToObj(null==e?void 0:e.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return"string"==typeof e?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:void 0===(null==e?void 0:e.precision)?null:null==e?void 0:e.precision,...c.errToObj(null==e?void 0:e.message)})}duration(e){return this._addCheck({kind:"duration",...c.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...c.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:null==t?void 0:t.position,...c.errToObj(null==t?void 0:t.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...c.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...c.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...c.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...c.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...c.errToObj(t)})}nonempty(e){return this.min(1,c.errToObj(e))}trim(){return new ei({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new ei({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new ei({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>"datetime"===e.kind)}get isDate(){return!!this._def.checks.find(e=>"date"===e.kind)}get isTime(){return!!this._def.checks.find(e=>"time"===e.kind)}get isDuration(){return!!this._def.checks.find(e=>"duration"===e.kind)}get isEmail(){return!!this._def.checks.find(e=>"email"===e.kind)}get isURL(){return!!this._def.checks.find(e=>"url"===e.kind)}get isEmoji(){return!!this._def.checks.find(e=>"emoji"===e.kind)}get isUUID(){return!!this._def.checks.find(e=>"uuid"===e.kind)}get isNANOID(){return!!this._def.checks.find(e=>"nanoid"===e.kind)}get isCUID(){return!!this._def.checks.find(e=>"cuid"===e.kind)}get isCUID2(){return!!this._def.checks.find(e=>"cuid2"===e.kind)}get isULID(){return!!this._def.checks.find(e=>"ulid"===e.kind)}get isIP(){return!!this._def.checks.find(e=>"ip"===e.kind)}get isCIDR(){return!!this._def.checks.find(e=>"cidr"===e.kind)}get isBase64(){return!!this._def.checks.find(e=>"base64"===e.kind)}get isBase64url(){return!!this._def.checks.find(e=>"base64url"===e.kind)}get minLength(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}ei.create=e=>{var t;return new ei({checks:[],typeName:p.ZodString,coerce:null!=(t=null==e?void 0:e.coerce)&&t,...D(e)})};class en extends H{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){let t;if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==g.number){let t=this._getOrReturnCtx(e);return A(t,{code:v.invalid_type,expected:g.number,received:t.parsedType}),T}let r=new S;for(let a of this._def.checks)"int"===a.kind?o.isInteger(e.data)||(A(t=this._getOrReturnCtx(e,t),{code:v.invalid_type,expected:"integer",received:"float",message:a.message}),r.dirty()):"min"===a.kind?(a.inclusive?e.data<a.value:e.data<=a.value)&&(A(t=this._getOrReturnCtx(e,t),{code:v.too_small,minimum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),r.dirty()):"max"===a.kind?(a.inclusive?e.data>a.value:e.data>=a.value)&&(A(t=this._getOrReturnCtx(e,t),{code:v.too_big,maximum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),r.dirty()):"multipleOf"===a.kind?0!==function(e,t){let r=(e.toString().split(".")[1]||"").length,a=(t.toString().split(".")[1]||"").length,i=r>a?r:a;return parseInt(e.toFixed(i).replace(".",""))%parseInt(t.toFixed(i).replace(".",""))/Math.pow(10,i)}(e.data,a.value)&&(A(t=this._getOrReturnCtx(e,t),{code:v.not_multiple_of,multipleOf:a.value,message:a.message}),r.dirty()):"finite"===a.kind?Number.isFinite(e.data)||(A(t=this._getOrReturnCtx(e,t),{code:v.not_finite,message:a.message}),r.dirty()):o.assertNever(a);return{status:r.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,c.toString(t))}gt(e,t){return this.setLimit("min",e,!1,c.toString(t))}lte(e,t){return this.setLimit("max",e,!0,c.toString(t))}lt(e,t){return this.setLimit("max",e,!1,c.toString(t))}setLimit(e,t,r,a){return new en({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:c.toString(a)}]})}_addCheck(e){return new en({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:c.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:c.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:c.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:c.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:c.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:c.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:c.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:c.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:c.toString(e)})}get minValue(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>"int"===e.kind||"multipleOf"===e.kind&&o.isInteger(e.value))}get isFinite(){let e=null,t=null;for(let r of this._def.checks)if("finite"===r.kind||"int"===r.kind||"multipleOf"===r.kind)return!0;else"min"===r.kind?(null===t||r.value>t)&&(t=r.value):"max"===r.kind&&(null===e||r.value<e)&&(e=r.value);return Number.isFinite(t)&&Number.isFinite(e)}}en.create=e=>new en({checks:[],typeName:p.ZodNumber,coerce:(null==e?void 0:e.coerce)||!1,...D(e)});class es extends H{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){let t;if(this._def.coerce)try{e.data=BigInt(e.data)}catch(t){return this._getInvalidInput(e)}if(this._getType(e)!==g.bigint)return this._getInvalidInput(e);let r=new S;for(let a of this._def.checks)"min"===a.kind?(a.inclusive?e.data<a.value:e.data<=a.value)&&(A(t=this._getOrReturnCtx(e,t),{code:v.too_small,type:"bigint",minimum:a.value,inclusive:a.inclusive,message:a.message}),r.dirty()):"max"===a.kind?(a.inclusive?e.data>a.value:e.data>=a.value)&&(A(t=this._getOrReturnCtx(e,t),{code:v.too_big,type:"bigint",maximum:a.value,inclusive:a.inclusive,message:a.message}),r.dirty()):"multipleOf"===a.kind?e.data%a.value!==BigInt(0)&&(A(t=this._getOrReturnCtx(e,t),{code:v.not_multiple_of,multipleOf:a.value,message:a.message}),r.dirty()):o.assertNever(a);return{status:r.value,value:e.data}}_getInvalidInput(e){let t=this._getOrReturnCtx(e);return A(t,{code:v.invalid_type,expected:g.bigint,received:t.parsedType}),T}gte(e,t){return this.setLimit("min",e,!0,c.toString(t))}gt(e,t){return this.setLimit("min",e,!1,c.toString(t))}lte(e,t){return this.setLimit("max",e,!0,c.toString(t))}lt(e,t){return this.setLimit("max",e,!1,c.toString(t))}setLimit(e,t,r,a){return new es({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:c.toString(a)}]})}_addCheck(e){return new es({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:c.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:c.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:c.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:c.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:c.toString(t)})}get minValue(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}es.create=e=>{var t;return new es({checks:[],typeName:p.ZodBigInt,coerce:null!=(t=null==e?void 0:e.coerce)&&t,...D(e)})};class eo extends H{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==g.boolean){let t=this._getOrReturnCtx(e);return A(t,{code:v.invalid_type,expected:g.boolean,received:t.parsedType}),T}return C(e.data)}}eo.create=e=>new eo({typeName:p.ZodBoolean,coerce:(null==e?void 0:e.coerce)||!1,...D(e)});class ed extends H{_parse(e){let t;if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==g.date){let t=this._getOrReturnCtx(e);return A(t,{code:v.invalid_type,expected:g.date,received:t.parsedType}),T}if(isNaN(e.data.getTime()))return A(this._getOrReturnCtx(e),{code:v.invalid_date}),T;let r=new S;for(let a of this._def.checks)"min"===a.kind?e.data.getTime()<a.value&&(A(t=this._getOrReturnCtx(e,t),{code:v.too_small,message:a.message,inclusive:!0,exact:!1,minimum:a.value,type:"date"}),r.dirty()):"max"===a.kind?e.data.getTime()>a.value&&(A(t=this._getOrReturnCtx(e,t),{code:v.too_big,message:a.message,inclusive:!0,exact:!1,maximum:a.value,type:"date"}),r.dirty()):o.assertNever(a);return{status:r.value,value:new Date(e.data.getTime())}}_addCheck(e){return new ed({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:c.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:c.toString(t)})}get minDate(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return null!=e?new Date(e):null}get maxDate(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return null!=e?new Date(e):null}}ed.create=e=>new ed({checks:[],coerce:(null==e?void 0:e.coerce)||!1,typeName:p.ZodDate,...D(e)});class ec extends H{_parse(e){if(this._getType(e)!==g.symbol){let t=this._getOrReturnCtx(e);return A(t,{code:v.invalid_type,expected:g.symbol,received:t.parsedType}),T}return C(e.data)}}ec.create=e=>new ec({typeName:p.ZodSymbol,...D(e)});class el extends H{_parse(e){if(this._getType(e)!==g.undefined){let t=this._getOrReturnCtx(e);return A(t,{code:v.invalid_type,expected:g.undefined,received:t.parsedType}),T}return C(e.data)}}el.create=e=>new el({typeName:p.ZodUndefined,...D(e)});class eu extends H{_parse(e){if(this._getType(e)!==g.null){let t=this._getOrReturnCtx(e);return A(t,{code:v.invalid_type,expected:g.null,received:t.parsedType}),T}return C(e.data)}}eu.create=e=>new eu({typeName:p.ZodNull,...D(e)});class ep extends H{constructor(){super(...arguments),this._any=!0}_parse(e){return C(e.data)}}ep.create=e=>new ep({typeName:p.ZodAny,...D(e)});class eh extends H{constructor(){super(...arguments),this._unknown=!0}_parse(e){return C(e.data)}}eh.create=e=>new eh({typeName:p.ZodUnknown,...D(e)});class ef extends H{_parse(e){let t=this._getOrReturnCtx(e);return A(t,{code:v.invalid_type,expected:g.never,received:t.parsedType}),T}}ef.create=e=>new ef({typeName:p.ZodNever,...D(e)});class em extends H{_parse(e){if(this._getType(e)!==g.undefined){let t=this._getOrReturnCtx(e);return A(t,{code:v.invalid_type,expected:g.void,received:t.parsedType}),T}return C(e.data)}}em.create=e=>new em({typeName:p.ZodVoid,...D(e)});class ey extends H{_parse(e){let{ctx:t,status:r}=this._processInputParams(e),a=this._def;if(t.parsedType!==g.array)return A(t,{code:v.invalid_type,expected:g.array,received:t.parsedType}),T;if(null!==a.exactLength){let e=t.data.length>a.exactLength.value,i=t.data.length<a.exactLength.value;(e||i)&&(A(t,{code:e?v.too_big:v.too_small,minimum:i?a.exactLength.value:void 0,maximum:e?a.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:a.exactLength.message}),r.dirty())}if(null!==a.minLength&&t.data.length<a.minLength.value&&(A(t,{code:v.too_small,minimum:a.minLength.value,type:"array",inclusive:!0,exact:!1,message:a.minLength.message}),r.dirty()),null!==a.maxLength&&t.data.length>a.maxLength.value&&(A(t,{code:v.too_big,maximum:a.maxLength.value,type:"array",inclusive:!0,exact:!1,message:a.maxLength.message}),r.dirty()),t.common.async)return Promise.all([...t.data].map((e,r)=>a.type._parseAsync(new N(t,e,t.path,r)))).then(e=>S.mergeArray(r,e));let i=[...t.data].map((e,r)=>a.type._parseSync(new N(t,e,t.path,r)));return S.mergeArray(r,i)}get element(){return this._def.type}min(e,t){return new ey({...this._def,minLength:{value:e,message:c.toString(t)}})}max(e,t){return new ey({...this._def,maxLength:{value:e,message:c.toString(t)}})}length(e,t){return new ey({...this._def,exactLength:{value:e,message:c.toString(t)}})}nonempty(e){return this.min(1,e)}}ey.create=(e,t)=>new ey({type:e,minLength:null,maxLength:null,exactLength:null,typeName:p.ZodArray,...D(t)});class eg extends H{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(null!==this._cached)return this._cached;let e=this._def.shape(),t=o.objectKeys(e);return this._cached={shape:e,keys:t}}_parse(e){if(this._getType(e)!==g.object){let t=this._getOrReturnCtx(e);return A(t,{code:v.invalid_type,expected:g.object,received:t.parsedType}),T}let{status:t,ctx:r}=this._processInputParams(e),{shape:a,keys:i}=this._getCached(),n=[];if(!(this._def.catchall instanceof ef&&"strip"===this._def.unknownKeys))for(let e in r.data)i.includes(e)||n.push(e);let s=[];for(let e of i){let t=a[e],i=r.data[e];s.push({key:{status:"valid",value:e},value:t._parse(new N(r,i,r.path,e)),alwaysSet:e in r.data})}if(this._def.catchall instanceof ef){let e=this._def.unknownKeys;if("passthrough"===e)for(let e of n)s.push({key:{status:"valid",value:e},value:{status:"valid",value:r.data[e]}});else if("strict"===e)n.length>0&&(A(r,{code:v.unrecognized_keys,keys:n}),t.dirty());else if("strip"===e);else throw Error("Internal ZodObject error: invalid unknownKeys value.")}else{let e=this._def.catchall;for(let t of n){let a=r.data[t];s.push({key:{status:"valid",value:t},value:e._parse(new N(r,a,r.path,t)),alwaysSet:t in r.data})}}return r.common.async?Promise.resolve().then(async()=>{let e=[];for(let t of s){let r=await t.key,a=await t.value;e.push({key:r,value:a,alwaysSet:t.alwaysSet})}return e}).then(e=>S.mergeObjectSync(t,e)):S.mergeObjectSync(t,s)}get shape(){return this._def.shape()}strict(e){return c.errToObj,new eg({...this._def,unknownKeys:"strict",...void 0!==e?{errorMap:(t,r)=>{var a,i,n,s;let o=null!=(n=null==(i=(a=this._def).errorMap)?void 0:i.call(a,t,r).message)?n:r.defaultError;return"unrecognized_keys"===t.code?{message:null!=(s=c.errToObj(e).message)?s:o}:{message:o}}}:{}})}strip(){return new eg({...this._def,unknownKeys:"strip"})}passthrough(){return new eg({...this._def,unknownKeys:"passthrough"})}extend(e){return new eg({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new eg({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:p.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new eg({...this._def,catchall:e})}pick(e){let t={};return o.objectKeys(e).forEach(r=>{e[r]&&this.shape[r]&&(t[r]=this.shape[r])}),new eg({...this._def,shape:()=>t})}omit(e){let t={};return o.objectKeys(this.shape).forEach(r=>{e[r]||(t[r]=this.shape[r])}),new eg({...this._def,shape:()=>t})}deepPartial(){return function e(t){if(t instanceof eg){let r={};for(let a in t.shape){let i=t.shape[a];r[a]=ej.create(e(i))}return new eg({...t._def,shape:()=>r})}if(t instanceof ey)return new ey({...t._def,type:e(t.element)});if(t instanceof ej)return ej.create(e(t.unwrap()));if(t instanceof eZ)return eZ.create(e(t.unwrap()));if(t instanceof eb)return eb.create(t.items.map(t=>e(t)));else return t}(this)}partial(e){let t={};return o.objectKeys(this.shape).forEach(r=>{let a=this.shape[r];e&&!e[r]?t[r]=a:t[r]=a.optional()}),new eg({...this._def,shape:()=>t})}required(e){let t={};return o.objectKeys(this.shape).forEach(r=>{if(e&&!e[r])t[r]=this.shape[r];else{let e=this.shape[r];for(;e instanceof ej;)e=e._def.innerType;t[r]=e}}),new eg({...this._def,shape:()=>t})}keyof(){return eC(o.objectKeys(this.shape))}}eg.create=(e,t)=>new eg({shape:()=>e,unknownKeys:"strip",catchall:ef.create(),typeName:p.ZodObject,...D(t)}),eg.strictCreate=(e,t)=>new eg({shape:()=>e,unknownKeys:"strict",catchall:ef.create(),typeName:p.ZodObject,...D(t)}),eg.lazycreate=(e,t)=>new eg({shape:e,unknownKeys:"strip",catchall:ef.create(),typeName:p.ZodObject,...D(t)});class e_ extends H{_parse(e){let{ctx:t}=this._processInputParams(e),r=this._def.options;if(t.common.async)return Promise.all(r.map(async e=>{let r={...t,common:{...t.common,issues:[]},parent:null};return{result:await e._parseAsync({data:t.data,path:t.path,parent:r}),ctx:r}})).then(function(e){for(let t of e)if("valid"===t.result.status)return t.result;for(let r of e)if("dirty"===r.result.status)return t.common.issues.push(...r.ctx.common.issues),r.result;let r=e.map(e=>new w(e.ctx.common.issues));return A(t,{code:v.invalid_union,unionErrors:r}),T});{let e,a=[];for(let i of r){let r={...t,common:{...t.common,issues:[]},parent:null},n=i._parseSync({data:t.data,path:t.path,parent:r});if("valid"===n.status)return n;"dirty"!==n.status||e||(e={result:n,ctx:r}),r.common.issues.length&&a.push(r.common.issues)}if(e)return t.common.issues.push(...e.ctx.common.issues),e.result;let i=a.map(e=>new w(e));return A(t,{code:v.invalid_union,unionErrors:i}),T}}get options(){return this._def.options}}e_.create=(e,t)=>new e_({options:e,typeName:p.ZodUnion,...D(t)});let ev=e=>{if(e instanceof eT)return ev(e.schema);if(e instanceof eU)return ev(e.innerType());if(e instanceof eO)return[e.value];if(e instanceof eR)return e.options;if(e instanceof eP)return o.objectValues(e.enum);else if(e instanceof eN)return ev(e._def.innerType);else if(e instanceof el)return[void 0];else if(e instanceof eu)return[null];else if(e instanceof ej)return[void 0,...ev(e.unwrap())];else if(e instanceof eZ)return[null,...ev(e.unwrap())];else if(e instanceof eM)return ev(e.unwrap());else if(e instanceof eW)return ev(e.unwrap());else if(e instanceof eK)return ev(e._def.innerType);else return[]};class ew extends H{_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==g.object)return A(t,{code:v.invalid_type,expected:g.object,received:t.parsedType}),T;let r=this.discriminator,a=t.data[r],i=this.optionsMap.get(a);return i?t.common.async?i._parseAsync({data:t.data,path:t.path,parent:t}):i._parseSync({data:t.data,path:t.path,parent:t}):(A(t,{code:v.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[r]}),T)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,r){let a=new Map;for(let r of t){let t=ev(r.shape[e]);if(!t.length)throw Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(let i of t){if(a.has(i))throw Error(`Discriminator property ${String(e)} has duplicate value ${String(i)}`);a.set(i,r)}}return new ew({typeName:p.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:a,...D(r)})}}class eE extends H{_parse(e){let{status:t,ctx:r}=this._processInputParams(e),a=(e,a)=>{if(R(e)||R(a))return T;let i=function e(t,r){let a=_(t),i=_(r);if(t===r)return{valid:!0,data:t};if(a===g.object&&i===g.object){let a=o.objectKeys(r),i=o.objectKeys(t).filter(e=>-1!==a.indexOf(e)),n={...t,...r};for(let a of i){let i=e(t[a],r[a]);if(!i.valid)return{valid:!1};n[a]=i.data}return{valid:!0,data:n}}if(a===g.array&&i===g.array){if(t.length!==r.length)return{valid:!1};let a=[];for(let i=0;i<t.length;i++){let n=e(t[i],r[i]);if(!n.valid)return{valid:!1};a.push(n.data)}return{valid:!0,data:a}}if(a===g.date&&i===g.date&&+t==+r)return{valid:!0,data:t};return{valid:!1}}(e.value,a.value);return i.valid?((P(e)||P(a))&&t.dirty(),{status:t.value,value:i.data}):(A(r,{code:v.invalid_intersection_types}),T)};return r.common.async?Promise.all([this._def.left._parseAsync({data:r.data,path:r.path,parent:r}),this._def.right._parseAsync({data:r.data,path:r.path,parent:r})]).then(([e,t])=>a(e,t)):a(this._def.left._parseSync({data:r.data,path:r.path,parent:r}),this._def.right._parseSync({data:r.data,path:r.path,parent:r}))}}eE.create=(e,t,r)=>new eE({left:e,right:t,typeName:p.ZodIntersection,...D(r)});class eb extends H{_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==g.array)return A(r,{code:v.invalid_type,expected:g.array,received:r.parsedType}),T;if(r.data.length<this._def.items.length)return A(r,{code:v.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),T;!this._def.rest&&r.data.length>this._def.items.length&&(A(r,{code:v.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());let a=[...r.data].map((e,t)=>{let a=this._def.items[t]||this._def.rest;return a?a._parse(new N(r,e,r.path,t)):null}).filter(e=>!!e);return r.common.async?Promise.all(a).then(e=>S.mergeArray(t,e)):S.mergeArray(t,a)}get items(){return this._def.items}rest(e){return new eb({...this._def,rest:e})}}eb.create=(e,t)=>{if(!Array.isArray(e))throw Error("You must pass an array of schemas to z.tuple([ ... ])");return new eb({items:e,typeName:p.ZodTuple,rest:null,...D(t)})};class ek extends H{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==g.object)return A(r,{code:v.invalid_type,expected:g.object,received:r.parsedType}),T;let a=[],i=this._def.keyType,n=this._def.valueType;for(let e in r.data)a.push({key:i._parse(new N(r,e,r.path,e)),value:n._parse(new N(r,r.data[e],r.path,e)),alwaysSet:e in r.data});return r.common.async?S.mergeObjectAsync(t,a):S.mergeObjectSync(t,a)}get element(){return this._def.valueType}static create(e,t,r){return new ek(t instanceof H?{keyType:e,valueType:t,typeName:p.ZodRecord,...D(r)}:{keyType:ei.create(),valueType:e,typeName:p.ZodRecord,...D(t)})}}class ex extends H{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==g.map)return A(r,{code:v.invalid_type,expected:g.map,received:r.parsedType}),T;let a=this._def.keyType,i=this._def.valueType,n=[...r.data.entries()].map(([e,t],n)=>({key:a._parse(new N(r,e,r.path,[n,"key"])),value:i._parse(new N(r,t,r.path,[n,"value"]))}));if(r.common.async){let e=new Map;return Promise.resolve().then(async()=>{for(let r of n){let a=await r.key,i=await r.value;if("aborted"===a.status||"aborted"===i.status)return T;("dirty"===a.status||"dirty"===i.status)&&t.dirty(),e.set(a.value,i.value)}return{status:t.value,value:e}})}{let e=new Map;for(let r of n){let a=r.key,i=r.value;if("aborted"===a.status||"aborted"===i.status)return T;("dirty"===a.status||"dirty"===i.status)&&t.dirty(),e.set(a.value,i.value)}return{status:t.value,value:e}}}}ex.create=(e,t,r)=>new ex({valueType:t,keyType:e,typeName:p.ZodMap,...D(r)});class eA extends H{_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==g.set)return A(r,{code:v.invalid_type,expected:g.set,received:r.parsedType}),T;let a=this._def;null!==a.minSize&&r.data.size<a.minSize.value&&(A(r,{code:v.too_small,minimum:a.minSize.value,type:"set",inclusive:!0,exact:!1,message:a.minSize.message}),t.dirty()),null!==a.maxSize&&r.data.size>a.maxSize.value&&(A(r,{code:v.too_big,maximum:a.maxSize.value,type:"set",inclusive:!0,exact:!1,message:a.maxSize.message}),t.dirty());let i=this._def.valueType;function n(e){let r=new Set;for(let a of e){if("aborted"===a.status)return T;"dirty"===a.status&&t.dirty(),r.add(a.value)}return{status:t.value,value:r}}let s=[...r.data.values()].map((e,t)=>i._parse(new N(r,e,r.path,t)));return r.common.async?Promise.all(s).then(e=>n(e)):n(s)}min(e,t){return new eA({...this._def,minSize:{value:e,message:c.toString(t)}})}max(e,t){return new eA({...this._def,maxSize:{value:e,message:c.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}eA.create=(e,t)=>new eA({valueType:e,minSize:null,maxSize:null,typeName:p.ZodSet,...D(t)});class eS extends H{constructor(){super(...arguments),this.validate=this.implement}_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==g.function)return A(t,{code:v.invalid_type,expected:g.function,received:t.parsedType}),T;function r(e,r){return x({data:e,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,k(),E].filter(e=>!!e),issueData:{code:v.invalid_arguments,argumentsError:r}})}function a(e,r){return x({data:e,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,k(),E].filter(e=>!!e),issueData:{code:v.invalid_return_type,returnTypeError:r}})}let i={errorMap:t.common.contextualErrorMap},n=t.data;if(this._def.returns instanceof eI){let e=this;return C(async function(...t){let s=new w([]),o=await e._def.args.parseAsync(t,i).catch(e=>{throw s.addIssue(r(t,e)),s}),d=await Reflect.apply(n,this,o);return await e._def.returns._def.type.parseAsync(d,i).catch(e=>{throw s.addIssue(a(d,e)),s})})}{let e=this;return C(function(...t){let s=e._def.args.safeParse(t,i);if(!s.success)throw new w([r(t,s.error)]);let o=Reflect.apply(n,this,s.data),d=e._def.returns.safeParse(o,i);if(!d.success)throw new w([a(o,d.error)]);return d.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new eS({...this._def,args:eb.create(e).rest(eh.create())})}returns(e){return new eS({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,t,r){return new eS({args:e||eb.create([]).rest(eh.create()),returns:t||eh.create(),typeName:p.ZodFunction,...D(r)})}}class eT extends H{get schema(){return this._def.getter()}_parse(e){let{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}}eT.create=(e,t)=>new eT({getter:e,typeName:p.ZodLazy,...D(t)});class eO extends H{_parse(e){if(e.data!==this._def.value){let t=this._getOrReturnCtx(e);return A(t,{received:t.data,code:v.invalid_literal,expected:this._def.value}),T}return{status:"valid",value:e.data}}get value(){return this._def.value}}function eC(e,t){return new eR({values:e,typeName:p.ZodEnum,...D(t)})}eO.create=(e,t)=>new eO({value:e,typeName:p.ZodLiteral,...D(t)});class eR extends H{constructor(){super(...arguments),l.set(this,void 0)}_parse(e){if("string"!=typeof e.data){let t=this._getOrReturnCtx(e),r=this._def.values;return A(t,{expected:o.joinValues(r),received:t.parsedType,code:v.invalid_type}),T}if(j(this,l,"f")||Z(this,l,new Set(this._def.values),"f"),!j(this,l,"f").has(e.data)){let t=this._getOrReturnCtx(e),r=this._def.values;return A(t,{received:t.data,code:v.invalid_enum_value,options:r}),T}return C(e.data)}get options(){return this._def.values}get enum(){let e={};for(let t of this._def.values)e[t]=t;return e}get Values(){let e={};for(let t of this._def.values)e[t]=t;return e}get Enum(){let e={};for(let t of this._def.values)e[t]=t;return e}extract(e,t=this._def){return eR.create(e,{...this._def,...t})}exclude(e,t=this._def){return eR.create(this.options.filter(t=>!e.includes(t)),{...this._def,...t})}}l=new WeakMap,eR.create=eC;class eP extends H{constructor(){super(...arguments),u.set(this,void 0)}_parse(e){let t=o.getValidEnumValues(this._def.values),r=this._getOrReturnCtx(e);if(r.parsedType!==g.string&&r.parsedType!==g.number){let e=o.objectValues(t);return A(r,{expected:o.joinValues(e),received:r.parsedType,code:v.invalid_type}),T}if(j(this,u,"f")||Z(this,u,new Set(o.getValidEnumValues(this._def.values)),"f"),!j(this,u,"f").has(e.data)){let e=o.objectValues(t);return A(r,{received:r.data,code:v.invalid_enum_value,options:e}),T}return C(e.data)}get enum(){return this._def.values}}u=new WeakMap,eP.create=(e,t)=>new eP({values:e,typeName:p.ZodNativeEnum,...D(t)});class eI extends H{unwrap(){return this._def.type}_parse(e){let{ctx:t}=this._processInputParams(e);return t.parsedType!==g.promise&&!1===t.common.async?(A(t,{code:v.invalid_type,expected:g.promise,received:t.parsedType}),T):C((t.parsedType===g.promise?t.data:Promise.resolve(t.data)).then(e=>this._def.type.parseAsync(e,{path:t.path,errorMap:t.common.contextualErrorMap})))}}eI.create=(e,t)=>new eI({type:e,typeName:p.ZodPromise,...D(t)});class eU extends H{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===p.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){let{status:t,ctx:r}=this._processInputParams(e),a=this._def.effect||null,i={addIssue:e=>{A(r,e),e.fatal?t.abort():t.dirty()},get path(){return r.path}};if(i.addIssue=i.addIssue.bind(i),"preprocess"===a.type){let e=a.transform(r.data,i);if(r.common.async)return Promise.resolve(e).then(async e=>{if("aborted"===t.value)return T;let a=await this._def.schema._parseAsync({data:e,path:r.path,parent:r});return"aborted"===a.status?T:"dirty"===a.status||"dirty"===t.value?O(a.value):a});{if("aborted"===t.value)return T;let a=this._def.schema._parseSync({data:e,path:r.path,parent:r});return"aborted"===a.status?T:"dirty"===a.status||"dirty"===t.value?O(a.value):a}}if("refinement"===a.type){let e=e=>{let t=a.refinement(e,i);if(r.common.async)return Promise.resolve(t);if(t instanceof Promise)throw Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return e};if(!1!==r.common.async)return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(r=>"aborted"===r.status?T:("dirty"===r.status&&t.dirty(),e(r.value).then(()=>({status:t.value,value:r.value}))));{let a=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});return"aborted"===a.status?T:("dirty"===a.status&&t.dirty(),e(a.value),{status:t.value,value:a.value})}}if("transform"===a.type)if(!1!==r.common.async)return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(e=>I(e)?Promise.resolve(a.transform(e.value,i)).then(e=>({status:t.value,value:e})):e);else{let e=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});if(!I(e))return e;let n=a.transform(e.value,i);if(n instanceof Promise)throw Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:n}}o.assertNever(a)}}eU.create=(e,t,r)=>new eU({schema:e,typeName:p.ZodEffects,effect:t,...D(r)}),eU.createWithPreprocess=(e,t,r)=>new eU({schema:t,effect:{type:"preprocess",transform:e},typeName:p.ZodEffects,...D(r)});class ej extends H{_parse(e){return this._getType(e)===g.undefined?C(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}ej.create=(e,t)=>new ej({innerType:e,typeName:p.ZodOptional,...D(t)});class eZ extends H{_parse(e){return this._getType(e)===g.null?C(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}eZ.create=(e,t)=>new eZ({innerType:e,typeName:p.ZodNullable,...D(t)});class eN extends H{_parse(e){let{ctx:t}=this._processInputParams(e),r=t.data;return t.parsedType===g.undefined&&(r=this._def.defaultValue()),this._def.innerType._parse({data:r,path:t.path,parent:t})}removeDefault(){return this._def.innerType}}eN.create=(e,t)=>new eN({innerType:e,typeName:p.ZodDefault,defaultValue:"function"==typeof t.default?t.default:()=>t.default,...D(t)});class eK extends H{_parse(e){let{ctx:t}=this._processInputParams(e),r={...t,common:{...t.common,issues:[]}},a=this._def.innerType._parse({data:r.data,path:r.path,parent:{...r}});return U(a)?a.then(e=>({status:"valid",value:"valid"===e.status?e.value:this._def.catchValue({get error(){return new w(r.common.issues)},input:r.data})})):{status:"valid",value:"valid"===a.status?a.value:this._def.catchValue({get error(){return new w(r.common.issues)},input:r.data})}}removeCatch(){return this._def.innerType}}eK.create=(e,t)=>new eK({innerType:e,typeName:p.ZodCatch,catchValue:"function"==typeof t.catch?t.catch:()=>t.catch,...D(t)});class eD extends H{_parse(e){if(this._getType(e)!==g.nan){let t=this._getOrReturnCtx(e);return A(t,{code:v.invalid_type,expected:g.nan,received:t.parsedType}),T}return{status:"valid",value:e.data}}}eD.create=e=>new eD({typeName:p.ZodNaN,...D(e)});let eH=Symbol("zod_brand");class eM extends H{_parse(e){let{ctx:t}=this._processInputParams(e),r=t.data;return this._def.type._parse({data:r,path:t.path,parent:t})}unwrap(){return this._def.type}}class e$ extends H{_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.common.async)return(async()=>{let e=await this._def.in._parseAsync({data:r.data,path:r.path,parent:r});return"aborted"===e.status?T:"dirty"===e.status?(t.dirty(),O(e.value)):this._def.out._parseAsync({data:e.value,path:r.path,parent:r})})();{let e=this._def.in._parseSync({data:r.data,path:r.path,parent:r});return"aborted"===e.status?T:"dirty"===e.status?(t.dirty(),{status:"dirty",value:e.value}):this._def.out._parseSync({data:e.value,path:r.path,parent:r})}}static create(e,t){return new e$({in:e,out:t,typeName:p.ZodPipeline})}}class eW extends H{_parse(e){let t=this._def.innerType._parse(e),r=e=>(I(e)&&(e.value=Object.freeze(e.value)),e);return U(t)?t.then(e=>r(e)):r(t)}unwrap(){return this._def.innerType}}function eL(e,t){let r="function"==typeof e?e(t):"string"==typeof e?{message:e}:e;return"string"==typeof r?{message:r}:r}function eB(e,t={},r){return e?ep.create().superRefine((a,i)=>{var n,s;let o=e(a);if(o instanceof Promise)return o.then(e=>{var n,s;if(!e){let e=eL(t,a),o=null==(s=null!=(n=e.fatal)?n:r)||s;i.addIssue({code:"custom",...e,fatal:o})}});if(!o){let e=eL(t,a),o=null==(s=null!=(n=e.fatal)?n:r)||s;i.addIssue({code:"custom",...e,fatal:o})}}):ep.create()}eW.create=(e,t)=>new eW({innerType:e,typeName:p.ZodReadonly,...D(t)});let eF={object:eg.lazycreate};!function(e){e.ZodString="ZodString",e.ZodNumber="ZodNumber",e.ZodNaN="ZodNaN",e.ZodBigInt="ZodBigInt",e.ZodBoolean="ZodBoolean",e.ZodDate="ZodDate",e.ZodSymbol="ZodSymbol",e.ZodUndefined="ZodUndefined",e.ZodNull="ZodNull",e.ZodAny="ZodAny",e.ZodUnknown="ZodUnknown",e.ZodNever="ZodNever",e.ZodVoid="ZodVoid",e.ZodArray="ZodArray",e.ZodObject="ZodObject",e.ZodUnion="ZodUnion",e.ZodDiscriminatedUnion="ZodDiscriminatedUnion",e.ZodIntersection="ZodIntersection",e.ZodTuple="ZodTuple",e.ZodRecord="ZodRecord",e.ZodMap="ZodMap",e.ZodSet="ZodSet",e.ZodFunction="ZodFunction",e.ZodLazy="ZodLazy",e.ZodLiteral="ZodLiteral",e.ZodEnum="ZodEnum",e.ZodEffects="ZodEffects",e.ZodNativeEnum="ZodNativeEnum",e.ZodOptional="ZodOptional",e.ZodNullable="ZodNullable",e.ZodDefault="ZodDefault",e.ZodCatch="ZodCatch",e.ZodPromise="ZodPromise",e.ZodBranded="ZodBranded",e.ZodPipeline="ZodPipeline",e.ZodReadonly="ZodReadonly"}(p||(p={}));let eJ=ei.create,ez=en.create,eG=eD.create,eV=es.create,eq=eo.create,eY=ed.create,eX=ec.create,eQ=el.create,e0=eu.create,e1=ep.create,e2=eh.create,e4=ef.create,e5=em.create,e8=ey.create,e6=eg.create,e9=eg.strictCreate,e3=e_.create,e7=ew.create,te=eE.create,tt=eb.create,tr=ek.create,ta=ex.create,ti=eA.create,tn=eS.create,ts=eT.create,to=eO.create,td=eR.create,tc=eP.create,tl=eI.create,tu=eU.create,tp=ej.create,th=eZ.create,tf=eU.createWithPreprocess,tm=e$.create;var ty=Object.freeze({__proto__:null,defaultErrorMap:E,setErrorMap:function(e){b=e},getErrorMap:k,makeIssue:x,EMPTY_PATH:[],addIssueToContext:A,ParseStatus:S,INVALID:T,DIRTY:O,OK:C,isAborted:R,isDirty:P,isValid:I,isAsync:U,get util(){return o},get objectUtil(){return d},ZodParsedType:g,getParsedType:_,ZodType:H,datetimeRegex:ea,ZodString:ei,ZodNumber:en,ZodBigInt:es,ZodBoolean:eo,ZodDate:ed,ZodSymbol:ec,ZodUndefined:el,ZodNull:eu,ZodAny:ep,ZodUnknown:eh,ZodNever:ef,ZodVoid:em,ZodArray:ey,ZodObject:eg,ZodUnion:e_,ZodDiscriminatedUnion:ew,ZodIntersection:eE,ZodTuple:eb,ZodRecord:ek,ZodMap:ex,ZodSet:eA,ZodFunction:eS,ZodLazy:eT,ZodLiteral:eO,ZodEnum:eR,ZodNativeEnum:eP,ZodPromise:eI,ZodEffects:eU,ZodTransformer:eU,ZodOptional:ej,ZodNullable:eZ,ZodDefault:eN,ZodCatch:eK,ZodNaN:eD,BRAND:eH,ZodBranded:eM,ZodPipeline:e$,ZodReadonly:eW,custom:eB,Schema:H,ZodSchema:H,late:eF,get ZodFirstPartyTypeKind(){return p},coerce:{string:e=>ei.create({...e,coerce:!0}),number:e=>en.create({...e,coerce:!0}),boolean:e=>eo.create({...e,coerce:!0}),bigint:e=>es.create({...e,coerce:!0}),date:e=>ed.create({...e,coerce:!0})},any:e1,array:e8,bigint:eV,boolean:eq,date:eY,discriminatedUnion:e7,effect:tu,enum:td,function:tn,instanceof:(e,t={message:`Input not instance of ${e.name}`})=>eB(t=>t instanceof e,t),intersection:te,lazy:ts,literal:to,map:ta,nan:eG,nativeEnum:tc,never:e4,null:e0,nullable:th,number:ez,object:e6,oboolean:()=>eq().optional(),onumber:()=>ez().optional(),optional:tp,ostring:()=>eJ().optional(),pipeline:tm,preprocess:tf,promise:tl,record:tr,set:ti,strictObject:e9,string:eJ,symbol:eX,transformer:tu,tuple:tt,undefined:eQ,union:e3,unknown:e2,void:e5,NEVER:T,ZodIssueCode:v,quotelessJson:e=>JSON.stringify(e,null,2).replace(/"([^"]+)":/g,"$1:"),ZodError:w});function tg(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}let t_={BAD_REQUEST:400,FILE_TOO_LARGE:400,MIME_TYPE_NOT_ALLOWED:400,UNAUTHORIZED:401,UPLOAD_NOT_ALLOWED:403,DELETE_NOT_ALLOWED:403,CREATE_CONTEXT_ERROR:500,SERVER_ERROR:500};class tv extends Error{formattedMessage(){return`${this.message}${this.details?`
    Details: ${JSON.stringify(this.details)}`:""}${this.cause?`
    Caused by: ${this.cause.message}`:""}`}formattedJson(){return{message:"SERVER_ERROR"===this.code?"Internal server error":this.message,code:this.code,details:this.details}}constructor(e){super(e.message),tg(this,"cause",void 0),tg(this,"code",void 0),tg(this,"level",void 0),tg(this,"details",void 0),this.name="EdgeStoreError",this.code=e.code,this.cause=e.cause,this.level=t_[e.code]>=500?"error":"warn",this.details="details"in e?e.details:void 0}}let tw=(e,t)=>{let r={...e,...t};return tE({type:r.type},r)};function tE(e,t){let r={type:e.type,input:ty.never(),path:[],metadata:()=>({}),...t};return{$config:{ctx:void 0},_def:r,input:e=>tw(r,{input:e}),path:e=>tw(r,{path:e(function(){let e=(t,r)=>new Proxy(()=>t,{get:(r,a)=>e(`${t}.${String(a)}`)});return new Proxy(()=>"",{get:(t,r)=>e(String(r))})}())}),metadata:e=>tw(r,{metadata:e}),accessControl:e=>tw(r,{accessControl:e}),beforeUpload:e=>tw(r,{beforeUpload:e}),beforeDelete:e=>tw(r,{beforeDelete:e})}}class tb{context(){return new tb}create(){return{imageBucket:e=>tk("IMAGE",e),fileBucket:e=>tk("FILE",e),router:function(e){return{$config:{ctx:void 0},buckets:e}}}}}function tk(e,t){return tE({type:e},{bucketConfig:t})}let tx=new tb,tA=["debug","info","warn","error","none"];class tS{shouldLog(e){return tA.indexOf(e)>=tA.indexOf(this.logLevel)}debug(e,...t){this.shouldLog("debug")&&console.debug("[EdgeStoreDebug]",e,...t)}info(e,...t){this.shouldLog("info")&&console.info("[EdgeStoreInfo]",e,...t)}warn(e,...t){this.shouldLog("warn")&&console.warn("[EdgeStoreWarn]",e,...t)}error(e,...t){this.shouldLog("error")&&console.error("[EdgeStoreError]",e,...t)}constructor(e){!function(e,t,r){t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r}(this,"logLevel",void 0),this.logLevel=e??"error"}}function tT(e,t){return RegExp(`${t}/?(\\?.*)?$`).test(e)}let tO=`Missing EDGE_STORE_ACCESS_KEY or EDGE_STORE_SECRET_KEY. 
This can happen if you are trying to import something related to the backend of Edge Store in a client component.`;class tC extends Error{constructor(e=tO){super(e),this.name="EdgeStoreCredentialsError"}}let tR=process.env.EDGE_STORE_API_ENDPOINT??"https://api.edgestore.dev";async function tP(e){let{body:t,accessKey:r,secretKey:a,path:i}=e,n=await fetch(`${tR}${i}`,{method:"POST",body:JSON.stringify(t),headers:{"Content-Type":"application/json",Authorization:`Basic ${Buffer.from(`${r}:${a}`).toString("base64")}`}});if(!n.ok)throw Error(`Failed to make request to ${i}: ${await n.text()}`);return await n.json()}let tI={async getToken(e){let t=Object.entries(e.router.buckets).reduce((e,[t,r])=>(e[t]={path:r._def.path.map(e=>{let t=Object.entries(e);if(void 0===t[0])throw new tv({message:`Empty path param found in: ${JSON.stringify(r._def.path)}`,code:"SERVER_ERROR"});let[a,i]=t[0];return{key:a,value:i()}}),accessControl:r._def.accessControl},e),{}),{token:r}=await tP({body:{ctx:e.ctx,buckets:t},accessKey:e.accessKey,secretKey:e.secretKey,path:"/get-token"});return r},getFile:async({accessKey:e,secretKey:t,url:r})=>await tP({path:"/get-file",accessKey:e,secretKey:t,body:{url:r}}),async requestUpload({accessKey:e,secretKey:t,bucketName:r,bucketType:a,fileInfo:i,multipart:n}){let s=await tP({path:"/request-upload",accessKey:e,secretKey:t,body:{multipart:n,bucketName:r,bucketType:a,isPublic:i.isPublic,path:i.path,extension:i.extension,size:i.size,mimeType:i.type,metadata:i.metadata,fileName:i.fileName,replaceTargetUrl:i.replaceTargetUrl,isTemporary:i.temporary}});return{multipart:s.multipart,signedUrl:s.signedUrl,accessUrl:s.url,path:s.path,thumbnailUrl:s.thumbnailUrl}},requestUploadParts:async({accessKey:e,secretKey:t,key:r,multipart:a})=>({multipart:(await tP({path:"/request-upload-parts",accessKey:e,secretKey:t,body:{multipart:a,key:r}})).multipart}),completeMultipartUpload:async({accessKey:e,secretKey:t,uploadId:r,key:a,parts:i})=>await tP({path:"/complete-multipart-upload",accessKey:e,secretKey:t,body:{uploadId:r,key:a,parts:i}}),confirmUpload:async({accessKey:e,secretKey:t,url:r})=>await tP({path:"/confirm-upload",accessKey:e,secretKey:t,body:{url:r}}),deleteFile:async({accessKey:e,secretKey:t,url:r})=>await tP({path:"/delete-file",accessKey:e,secretKey:t,body:{url:r}}),listFiles:async({accessKey:e,secretKey:t,bucketName:r,filter:a,pagination:i})=>await tP({path:"/list-files",accessKey:e,secretKey:t,body:{bucketName:r,filter:a,pagination:i}})},tU=require("crypto");var tj=r.n(tU);let tZ=(e,t,r,a,i)=>{let n=parseInt(e.substr(3),10)>>3||20,s=(0,tU.createHmac)(e,r.byteLength?r:new Uint8Array(n)).update(t).digest(),o=Math.ceil(i/n),d=new Uint8Array(n*o+a.byteLength+1),c=0,l=0;for(let t=1;t<=o;t++)d.set(a,l),d[l+a.byteLength]=t,d.set((0,tU.createHmac)(e,s).update(d.subarray(c,l+a.byteLength+1)).digest(),l),c=l,l+=n;return d.slice(0,i)};"function"!=typeof tU.hkdf||process.versions.electron||(i=async(...e)=>new Promise((t,r)=>{tU.hkdf(...e,(e,a)=>{e?r(e):t(new Uint8Array(a))})}));let tN=async(e,t,r,a,n)=>(i||tZ)(e,t,r,a,n);function tK(e,t){if("string"==typeof e)return new TextEncoder().encode(e);if(!(e instanceof Uint8Array))throw TypeError(`"${t}"" must be an instance of Uint8Array or a string`);return e}async function tD(e,t,r,a,i){return tN(function(e){switch(e){case"sha256":case"sha384":case"sha512":case"sha1":return e;default:throw TypeError('unsupported "digest" value')}}(e),function(e){let t=tK(e,"ikm");if(!t.byteLength)throw TypeError('"ikm" must be at least one byte in length');return t}(t),tK(r,"salt"),function(e){let t=tK(e,"info");if(t.byteLength>1024)throw TypeError('"info" must not contain more than 1024 bytes');return t}(a),function(e,t){if("number"!=typeof e||!Number.isInteger(e)||e<1)throw TypeError('"keylen" must be a positive integer');if(e>255*(parseInt(t.substr(3),10)>>3||20))throw TypeError('"keylen" too large');return e}(i,e))}var tH=r(93807);let tM=require("buffer"),t$=(e,t)=>(0,tU.createHash)(e).update(t).digest(),tW=new TextEncoder,tL=new TextDecoder;function tB(...e){let t=new Uint8Array(e.reduce((e,{length:t})=>e+t,0)),r=0;return e.forEach(e=>{t.set(e,r),r+=e.length}),t}function tF(e,t){return tB(tW.encode(e),new Uint8Array([0]),t)}function tJ(e,t,r){if(t<0||t>=0x100000000)throw RangeError(`value must be >= 0 and <= ${0x100000000-1}. Received ${t}`);e.set([t>>>24,t>>>16,t>>>8,255&t],r)}function tz(e){let t=new Uint8Array(4);return tJ(t,e),t}function tG(e){return tB(tz(e.length),e)}async function tV(e,t,r){let a=Math.ceil((t>>3)/32),i=new Uint8Array(32*a);for(let t=0;t<a;t++){let a=new Uint8Array(4+e.length+r.length);a.set(tz(t+1)),a.set(e,4),a.set(r,4+e.length),i.set(await t$("sha256",a),32*t)}return i.slice(0,t>>3)}n=tM.Buffer.isEncoding("base64url")?e=>tM.Buffer.from(e).toString("base64url"):e=>tM.Buffer.from(e).toString("base64").replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_");let tq=e=>tM.Buffer.from(function(e){let t=e;return t instanceof Uint8Array&&(t=tL.decode(t)),t}(e),"base64");class tY extends Error{static get code(){return"ERR_JOSE_GENERIC"}constructor(e){var t;super(e),this.code="ERR_JOSE_GENERIC",this.name=this.constructor.name,null==(t=Error.captureStackTrace)||t.call(Error,this,this.constructor)}}class tX extends tY{static get code(){return"ERR_JWT_CLAIM_VALIDATION_FAILED"}constructor(e,t="unspecified",r="unspecified"){super(e),this.code="ERR_JWT_CLAIM_VALIDATION_FAILED",this.claim=t,this.reason=r}}class tQ extends tY{static get code(){return"ERR_JWT_EXPIRED"}constructor(e,t="unspecified",r="unspecified"){super(e),this.code="ERR_JWT_EXPIRED",this.claim=t,this.reason=r}}class t0 extends tY{constructor(){super(...arguments),this.code="ERR_JOSE_ALG_NOT_ALLOWED"}static get code(){return"ERR_JOSE_ALG_NOT_ALLOWED"}}class t1 extends tY{constructor(){super(...arguments),this.code="ERR_JOSE_NOT_SUPPORTED"}static get code(){return"ERR_JOSE_NOT_SUPPORTED"}}class t2 extends tY{constructor(){super(...arguments),this.code="ERR_JWE_DECRYPTION_FAILED",this.message="decryption operation failed"}static get code(){return"ERR_JWE_DECRYPTION_FAILED"}}class t4 extends tY{constructor(){super(...arguments),this.code="ERR_JWE_DECOMPRESSION_FAILED",this.message="decompression operation failed"}static get code(){return"ERR_JWE_DECOMPRESSION_FAILED"}}class t5 extends tY{constructor(){super(...arguments),this.code="ERR_JWE_INVALID"}static get code(){return"ERR_JWE_INVALID"}}class t8 extends tY{constructor(){super(...arguments),this.code="ERR_JWT_INVALID"}static get code(){return"ERR_JWT_INVALID"}}function t6(e){switch(e){case"A128GCM":case"A128GCMKW":case"A192GCM":case"A192GCMKW":case"A256GCM":case"A256GCMKW":return 96;case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":return 128;default:throw new t1(`Unsupported JWE Algorithm: ${e}`)}}Symbol.asyncIterator;let t9=e=>(0,tU.randomFillSync)(new Uint8Array(t6(e)>>3)),t3=(e,t)=>{if(t.length<<3!==t6(e))throw new t5("Invalid Initialization Vector length")},t7=require("util"),re=t7.types.isKeyObject?e=>t7.types.isKeyObject(e):e=>null!=e&&e instanceof tU.KeyObject,rt=(e,t)=>{let r;switch(e){case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":r=parseInt(e.slice(-3),10);break;case"A128GCM":case"A192GCM":case"A256GCM":r=parseInt(e.slice(1,4),10);break;default:throw new t1(`Content Encryption Algorithm ${e} is not supported either by JOSE or your javascript runtime`)}if(t instanceof Uint8Array){let e=t.byteLength<<3;if(e!==r)throw new t5(`Invalid Content Encryption Key length. Expected ${r} bits, got ${e} bits`);return}if(re(t)&&"secret"===t.type){let e=t.symmetricKeySize<<3;if(e!==r)throw new t5(`Invalid Content Encryption Key length. Expected ${r} bits, got ${e} bits`);return}throw TypeError("Invalid Content Encryption Key type")};function rr(e,t,r,a,i,n){let s=tB(e,t,r,function(e){let t=Math.floor(e/0x100000000),r=new Uint8Array(8);return tJ(r,t,0),tJ(r,e%0x100000000,4),r}(e.length<<3)),o=(0,tU.createHmac)(`sha${a}`,i);return o.update(s),o.digest().slice(0,n>>3)}let ra=tU.webcrypto,ri=t7.types.isCryptoKey?e=>t7.types.isCryptoKey(e):e=>!1;function rn(e,t="algorithm.name"){return TypeError(`CryptoKey does not support this operation, its ${t} must be ${e}`)}function rs(e,t){return e.name===t}function ro(e,t,...r){switch(t){case"A128GCM":case"A192GCM":case"A256GCM":{if(!rs(e.algorithm,"AES-GCM"))throw rn("AES-GCM");let r=parseInt(t.slice(1,4),10);if(e.algorithm.length!==r)throw rn(r,"algorithm.length");break}case"A128KW":case"A192KW":case"A256KW":{if(!rs(e.algorithm,"AES-KW"))throw rn("AES-KW");let r=parseInt(t.slice(1,4),10);if(e.algorithm.length!==r)throw rn(r,"algorithm.length");break}case"ECDH":switch(e.algorithm.name){case"ECDH":case"X25519":case"X448":break;default:throw rn("ECDH, X25519, or X448")}break;case"PBES2-HS256+A128KW":case"PBES2-HS384+A192KW":case"PBES2-HS512+A256KW":if(!rs(e.algorithm,"PBKDF2"))throw rn("PBKDF2");break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":{if(!rs(e.algorithm,"RSA-OAEP"))throw rn("RSA-OAEP");let r=parseInt(t.slice(9),10)||1;if(parseInt(e.algorithm.hash.name.slice(4),10)!==r)throw rn(`SHA-${r}`,"algorithm.hash");break}default:throw TypeError("CryptoKey does not support this operation")}var a=e,i=r;if(i.length&&!i.some(e=>a.usages.includes(e))){let e="CryptoKey does not support this operation, its usages must include ";if(i.length>2){let t=i.pop();e+=`one of ${i.join(", ")}, or ${t}.`}else 2===i.length?e+=`one of ${i[0]} or ${i[1]}.`:e+=`${i[0]}.`;throw TypeError(e)}}function rd(e,t,...r){if(r.length>2){let t=r.pop();e+=`one of type ${r.join(", ")}, or ${t}.`}else 2===r.length?e+=`one of type ${r[0]} or ${r[1]}.`:e+=`of type ${r[0]}.`;return null==t?e+=` Received ${t}`:"function"==typeof t&&t.name?e+=` Received function ${t.name}`:"object"==typeof t&&null!=t&&t.constructor&&t.constructor.name&&(e+=` Received an instance of ${t.constructor.name}`),e}let rc=(e,...t)=>rd("Key must be ",e,...t);function rl(e,t,...r){return rd(`Key for the ${e} algorithm must be `,t,...r)}let ru=e=>(s||(s=new Set((0,tU.getCiphers)())),s.has(e)),rp=e=>re(e)||ri(e),rh=["KeyObject"];(globalThis.CryptoKey||(null==ra?void 0:ra.CryptoKey))&&rh.push("CryptoKey");let rf=(e,t,r,a,i)=>{let n;if(ri(r))ro(r,e,"encrypt"),n=tU.KeyObject.from(r);else if(r instanceof Uint8Array||re(r))n=r;else throw TypeError(rc(r,...rh,"Uint8Array"));switch(rt(e,n),t3(e,a),e){case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":return function(e,t,r,a,i){let n=parseInt(e.slice(1,4),10);re(r)&&(r=r.export());let s=r.subarray(n>>3),o=r.subarray(0,n>>3),d=`aes-${n}-cbc`;if(!ru(d))throw new t1(`alg ${e} is not supported by your javascript runtime`);let c=(0,tU.createCipheriv)(d,s,a),l=tB(c.update(t),c.final()),u=rr(i,a,l,parseInt(e.slice(-3),10),o,n);return{ciphertext:l,tag:u}}(e,t,n,a,i);case"A128GCM":case"A192GCM":case"A256GCM":return function(e,t,r,a,i){let n=parseInt(e.slice(1,4),10),s=`aes-${n}-gcm`;if(!ru(s))throw new t1(`alg ${e} is not supported by your javascript runtime`);let o=(0,tU.createCipheriv)(s,r,a,{authTagLength:16});i.byteLength&&o.setAAD(i,{plaintextLength:t.length});let d=o.update(t);return o.final(),{ciphertext:d,tag:o.getAuthTag()}}(e,t,n,a,i);default:throw new t1("Unsupported JWE Content Encryption Algorithm")}};var rm=r(74075);let ry=(0,t7.promisify)(rm.inflateRaw),rg=(0,t7.promisify)(rm.deflateRaw),r_=e=>ry(e,{maxOutputLength:25e4}).catch(()=>{throw new t4}),rv=e=>rg(e);function rw(e,t){if(e.symmetricKeySize<<3!==parseInt(t.slice(1,4),10))throw TypeError(`Invalid key size for alg: ${t}`)}function rE(e,t,r){if(re(e))return e;if(e instanceof Uint8Array)return(0,tU.createSecretKey)(e);if(ri(e))return ro(e,t,r),tU.KeyObject.from(e);throw TypeError(rc(e,...rh,"Uint8Array"))}let rb=(e,t,r)=>{let a=parseInt(e.slice(1,4),10),i=`aes${a}-wrap`;if(!ru(i))throw new t1(`alg ${e} is not supported either by JOSE or your javascript runtime`);let n=rE(t,e,"wrapKey");rw(n,e);let s=(0,tU.createCipheriv)(i,n,tM.Buffer.alloc(8,166));return tB(s.update(r),s.final())},rk=(e,t,r)=>{let a=parseInt(e.slice(1,4),10),i=`aes${a}-wrap`;if(!ru(i))throw new t1(`alg ${e} is not supported either by JOSE or your javascript runtime`);let n=rE(t,e,"unwrapKey");rw(n,e);let s=(0,tU.createDecipheriv)(i,n,tM.Buffer.alloc(8,166));return tB(s.update(r),s.final())},rx=tM.Buffer.from([42,134,72,206,61,3,1,7]),rA=tM.Buffer.from([43,129,4,0,34]),rS=tM.Buffer.from([43,129,4,0,35]),rT=tM.Buffer.from([43,129,4,0,10]),rO=new WeakMap,rC=e=>{switch(e){case"prime256v1":return"P-256";case"secp384r1":return"P-384";case"secp521r1":return"P-521";case"secp256k1":return"secp256k1";default:throw new t1("Unsupported key curve for this operation")}},rR=(e,t)=>{var r;let a;if(ri(e))a=tU.KeyObject.from(e);else if(re(e))a=e;else throw TypeError(rc(e,...rh));if("secret"===a.type)throw TypeError('only "private" or "public" type keys can be used for this operation');switch(a.asymmetricKeyType){case"ed25519":case"ed448":return`Ed${a.asymmetricKeyType.slice(2)}`;case"x25519":case"x448":return`X${a.asymmetricKeyType.slice(1)}`;case"ec":{if(rO.has(a))return rO.get(a);let e=null==(r=a.asymmetricKeyDetails)?void 0:r.namedCurve;if(e||"private"!==a.type){if(!e){let t=a.export({format:"der",type:"spki"}),r=t[1]<128?14:15,i=t[r],n=t.slice(r+1,r+1+i);if(n.equals(rx))e="prime256v1";else if(n.equals(rA))e="secp384r1";else if(n.equals(rS))e="secp521r1";else if(n.equals(rT))e="secp256k1";else throw new t1("Unsupported key curve for this operation")}}else e=rR((0,tU.createPublicKey)(a),!0);if(t)return e;let i=rC(e);return rO.set(a,i),i}default:throw TypeError("Invalid asymmetric key type for this operation")}},rP=(0,t7.promisify)(tU.generateKeyPair);async function rI(e,t,r,a,i=new Uint8Array(0),n=new Uint8Array(0)){let s,o;if(ri(e))ro(e,"ECDH"),s=tU.KeyObject.from(e);else if(re(e))s=e;else throw TypeError(rc(e,...rh));if(ri(t))ro(t,"ECDH","deriveBits"),o=tU.KeyObject.from(t);else if(re(t))o=t;else throw TypeError(rc(t,...rh));let d=tB(tG(tW.encode(r)),tG(i),tG(n),tz(a));return tV((0,tU.diffieHellman)({privateKey:o,publicKey:s}),a,d)}async function rU(e){let t;if(ri(e))t=tU.KeyObject.from(e);else if(re(e))t=e;else throw TypeError(rc(e,...rh));switch(t.asymmetricKeyType){case"x25519":return rP("x25519");case"x448":return rP("x448");case"ec":return rP("ec",{namedCurve:rR(t)});default:throw new t1("Invalid or unsupported EPK")}}let rj=e=>["P-256","P-384","P-521","X25519","X448"].includes(rR(e));function rZ(e){if(!(e instanceof Uint8Array)||e.length<8)throw new t5("PBES2 Salt Input must be 8 or more octets")}let rN=(0,t7.promisify)(tU.pbkdf2);function rK(e,t){if(re(e))return e.export();if(e instanceof Uint8Array)return e;if(ri(e))return ro(e,t,"deriveBits","deriveKey"),tU.KeyObject.from(e).export();throw TypeError(rc(e,...rh,"Uint8Array"))}let rD=async(e,t,r,a=2048,i=(0,tU.randomFillSync)(new Uint8Array(16)))=>{rZ(i);let s=tF(e,i),o=parseInt(e.slice(13,16),10)>>3,d=rK(t,e),c=await rN(d,s,a,o,`sha${e.slice(8,11)}`);return{encryptedKey:await rb(e.slice(-6),c,r),p2c:a,p2s:n(i)}},rH=async(e,t,r,a,i)=>{rZ(i);let n=tF(e,i),s=parseInt(e.slice(13,16),10)>>3,o=rK(t,e),d=await rN(o,n,a,s,`sha${e.slice(8,11)}`);return rk(e.slice(-6),d,r)},rM=new WeakMap,r$=(e,t)=>{let r=e.readUInt8(1);if((128&r)==0)return 0===t?r:r$(e.subarray(2+r),t-1);let a=127&r;r=0;for(let t=0;t<a;t++)r<<=8,r|=e.readUInt8(2+t);return 0===t?r:r$(e.subarray(2+r),t-1)},rW=(e,t)=>{let r=e.readUInt8(1);return(128&r)==0?r$(e.subarray(2),t):r$(e.subarray(2+(127&r)),t)},rL=e=>{var t,r;if(rM.has(e))return rM.get(e);let a=null!=(r=null==(t=e.asymmetricKeyDetails)?void 0:t.modulusLength)?r:rW(e.export({format:"der",type:"pkcs1"}),+("private"===e.type))-1<<3;return rM.set(e,a),a},rB=(e,t)=>{rM.set(e,t)},rF=(e,t)=>{if(2048>rL(e))throw TypeError(`${t} requires key modulusLength to be 2048 bits or larger`)},rJ=(e,t)=>{if("rsa"!==e.asymmetricKeyType)throw TypeError("Invalid key for this operation, its asymmetricKeyType must be rsa");rF(e,t)},rz=e=>{switch(e){case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":return tU.constants.RSA_PKCS1_OAEP_PADDING;case"RSA1_5":return tU.constants.RSA_PKCS1_PADDING;default:return}},rG=e=>{switch(e){case"RSA-OAEP":return"sha1";case"RSA-OAEP-256":return"sha256";case"RSA-OAEP-384":return"sha384";case"RSA-OAEP-512":return"sha512";default:return}};function rV(e,t,...r){if(re(e))return e;if(ri(e))return ro(e,t,...r),tU.KeyObject.from(e);throw TypeError(rc(e,...rh))}let rq=(e,t,r)=>{let a=rz(e),i=rG(e),n=rV(t,e,"wrapKey","encrypt");return rJ(n,e),(0,tU.publicEncrypt)({key:n,oaepHash:i,padding:a},r)},rY=(e,t,r)=>{let a=rz(e),i=rG(e),n=rV(t,e,"unwrapKey","decrypt");return rJ(n,e),(0,tU.privateDecrypt)({key:n,oaepHash:i,padding:a},r)};function rX(e){switch(e){case"A128GCM":return 128;case"A192GCM":return 192;case"A256GCM":case"A128CBC-HS256":return 256;case"A192CBC-HS384":return 384;case"A256CBC-HS512":return 512;default:throw new t1(`Unsupported JWE Algorithm: ${e}`)}}let rQ=e=>(0,tU.randomFillSync)(new Uint8Array(rX(e)>>3));class r0{constructor(e){if(48!==e[0]||(this.buffer=e,this.offset=1,this.decodeLength()!==e.length-this.offset))throw TypeError()}decodeLength(){let e=this.buffer[this.offset++];if(128&e){let t=-129&e;e=0;for(let r=0;r<t;r++)e=e<<8|this.buffer[this.offset+r];this.offset+=t}return e}unsignedInteger(){if(2!==this.buffer[this.offset++])throw TypeError();let e=this.decodeLength();0===this.buffer[this.offset]&&(this.offset++,e--);let t=this.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t}end(){if(this.offset!==this.buffer.length)throw TypeError()}}let[r1,r2]=process.versions.node.split(".").map(e=>parseInt(e,10));process.versions;let r4=r1>=16||15===r1&&r2>=9,r5=r1>=16||15===r1&&r2>=12,r8=e=>{let t;if(ri(e)){if(!e.extractable)throw TypeError("CryptoKey is not extractable");t=tU.KeyObject.from(e)}else if(re(e))t=e;else if(e instanceof Uint8Array)return{kty:"oct",k:n(e)};else throw TypeError(rc(e,...rh,"Uint8Array"));if(r4){if("secret"!==t.type&&!["rsa","ec","ed25519","x25519","ed448","x448"].includes(t.asymmetricKeyType))throw new t1("Unsupported key asymmetricKeyType");return t.export({format:"jwk"})}switch(t.type){case"secret":return{kty:"oct",k:n(t.export())};case"private":case"public":switch(t.asymmetricKeyType){case"rsa":{let e,r=new r0(t.export({format:"der",type:"pkcs1"}));"private"===t.type&&r.unsignedInteger();let a=n(r.unsignedInteger()),i=n(r.unsignedInteger());return"private"===t.type&&(e={d:n(r.unsignedInteger()),p:n(r.unsignedInteger()),q:n(r.unsignedInteger()),dp:n(r.unsignedInteger()),dq:n(r.unsignedInteger()),qi:n(r.unsignedInteger())}),r.end(),{kty:"RSA",n:a,e:i,...e}}case"ec":{let e,r,a,i=rR(t);switch(i){case"secp256k1":e=64,r=33,a=-1;break;case"P-256":e=64,r=36,a=-1;break;case"P-384":e=96,r=35,a=-3;break;case"P-521":e=132,r=35,a=-3;break;default:throw new t1("Unsupported curve")}if("public"===t.type){let r=t.export({type:"spki",format:"der"});return{kty:"EC",crv:i,x:n(r.subarray(-e,-e/2)),y:n(r.subarray(-e/2))}}let s=t.export({type:"pkcs8",format:"der"});return s.length<100&&(r+=a),{...r8((0,tU.createPublicKey)(t)),d:n(s.subarray(r,r+e/2))}}case"ed25519":case"x25519":{let e=rR(t);if("public"===t.type)return{kty:"OKP",crv:e,x:n(t.export({type:"spki",format:"der"}).subarray(-32))};let r=t.export({type:"pkcs8",format:"der"});return{...r8((0,tU.createPublicKey)(t)),d:n(r.subarray(-32))}}case"ed448":case"x448":{let e=rR(t);if("public"===t.type)return{kty:"OKP",crv:e,x:n(t.export({type:"spki",format:"der"}).subarray("Ed448"===e?-57:-56))};let r=t.export({type:"pkcs8",format:"der"});return{...r8((0,tU.createPublicKey)(t)),d:n(r.subarray("Ed448"===e?-57:-56))}}default:throw new t1("Unsupported key asymmetricKeyType")}default:throw new t1("Unsupported key type")}};async function r6(e){return r8(e)}let r9=(e,t)=>{if(!(t instanceof Uint8Array)){if(!rp(t))throw TypeError(rl(e,t,...rh,"Uint8Array"));if("secret"!==t.type)throw TypeError(`${rh.join(" or ")} instances for symmetric algorithms must be of type "secret"`)}},r3=(e,t,r)=>{if(!rp(t))throw TypeError(rl(e,t,...rh));if("secret"===t.type)throw TypeError(`${rh.join(" or ")} instances for asymmetric algorithms must not be of type "secret"`);if("sign"===r&&"public"===t.type)throw TypeError(`${rh.join(" or ")} instances for asymmetric algorithm signing must be of type "private"`);if("decrypt"===r&&"public"===t.type)throw TypeError(`${rh.join(" or ")} instances for asymmetric algorithm decryption must be of type "private"`);if(t.algorithm&&"verify"===r&&"private"===t.type)throw TypeError(`${rh.join(" or ")} instances for asymmetric algorithm verifying must be of type "public"`);if(t.algorithm&&"encrypt"===r&&"private"===t.type)throw TypeError(`${rh.join(" or ")} instances for asymmetric algorithm encryption must be of type "public"`)},r7=(e,t,r)=>{e.startsWith("HS")||"dir"===e||e.startsWith("PBES2")||/^A\d{3}(?:GCM)?KW$/.test(e)?r9(e,t):r3(e,t,r)},ae=tU.timingSafeEqual,at=(e,t,r,a,i,n)=>{let s;if(ri(t))ro(t,e,"decrypt"),s=tU.KeyObject.from(t);else if(t instanceof Uint8Array||re(t))s=t;else throw TypeError(rc(t,...rh,"Uint8Array"));switch(rt(e,s),t3(e,a),e){case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":return function(e,t,r,a,i,n){let s,o,d=parseInt(e.slice(1,4),10);re(t)&&(t=t.export());let c=t.subarray(d>>3),l=t.subarray(0,d>>3),u=parseInt(e.slice(-3),10),p=`aes-${d}-cbc`;if(!ru(p))throw new t1(`alg ${e} is not supported by your javascript runtime`);let h=rr(n,a,r,u,l,d);try{s=ae(i,h)}catch{}if(!s)throw new t2;try{let e=(0,tU.createDecipheriv)(p,c,a);o=tB(e.update(r),e.final())}catch{}if(!o)throw new t2;return o}(e,s,r,a,i,n);case"A128GCM":case"A192GCM":case"A256GCM":return function(e,t,r,a,i,n){let s=parseInt(e.slice(1,4),10),o=`aes-${s}-gcm`;if(!ru(o))throw new t1(`alg ${e} is not supported by your javascript runtime`);try{let e=(0,tU.createDecipheriv)(o,t,a,{authTagLength:16});e.setAuthTag(i),n.byteLength&&e.setAAD(n,{plaintextLength:r.length});let s=e.update(r);return e.final(),s}catch{throw new t2}}(e,s,r,a,i,n);default:throw new t1("Unsupported JWE Content Encryption Algorithm")}};async function ar(e,t,r,a){let i=e.slice(0,7);a||(a=t9(i));let{ciphertext:s,tag:o}=await rf(i,r,t,a,new Uint8Array(0));return{encryptedKey:s,iv:n(a),tag:n(o)}}async function aa(e,t,r,a,i){return at(e.slice(0,7),t,r,a,i,new Uint8Array(0))}async function ai(e,t,r,a,i={}){let s,o,d;switch(r7(e,r,"encrypt"),e){case"dir":d=r;break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":{if(!rj(r))throw new t1("ECDH with the provided key is not allowed or not supported by your javascript runtime");let{apu:c,apv:l}=i,{epk:u}=i;u||(u=(await rU(r)).privateKey);let{x:p,y:h,crv:f,kty:m}=await r6(u),y=await rI(r,u,"ECDH-ES"===e?t:e,"ECDH-ES"===e?rX(t):parseInt(e.slice(-5,-2),10),c,l);if(o={epk:{x:p,crv:f,kty:m}},"EC"===m&&(o.epk.y=h),c&&(o.apu=n(c)),l&&(o.apv=n(l)),"ECDH-ES"===e){d=y;break}d=a||rQ(t);let g=e.slice(-6);s=await rb(g,y,d);break}case"RSA1_5":case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":d=a||rQ(t),s=await rq(e,r,d);break;case"PBES2-HS256+A128KW":case"PBES2-HS384+A192KW":case"PBES2-HS512+A256KW":{d=a||rQ(t);let{p2c:n,p2s:c}=i;({encryptedKey:s,...o}=await rD(e,r,d,n,c));break}case"A128KW":case"A192KW":case"A256KW":d=a||rQ(t),s=await rb(e,r,d);break;case"A128GCMKW":case"A192GCMKW":case"A256GCMKW":{d=a||rQ(t);let{iv:n}=i;({encryptedKey:s,...o}=await ar(e,r,d,n));break}default:throw new t1('Invalid or unsupported "alg" (JWE Algorithm) header value')}return{cek:d,encryptedKey:s,parameters:o}}let an=(...e)=>{let t,r=e.filter(Boolean);if(0===r.length||1===r.length)return!0;for(let e of r){let r=Object.keys(e);if(!t||0===t.size){t=new Set(r);continue}for(let e of r){if(t.has(e))return!1;t.add(e)}}return!0},as=function(e,t,r,a,i){let n;if(void 0!==i.crit&&void 0===a.crit)throw new e('"crit" (Critical) Header Parameter MUST be integrity protected');if(!a||void 0===a.crit)return new Set;if(!Array.isArray(a.crit)||0===a.crit.length||a.crit.some(e=>"string"!=typeof e||0===e.length))throw new e('"crit" (Critical) Header Parameter MUST be an array of non-empty strings when present');for(let s of(n=void 0!==r?new Map([...Object.entries(r),...t.entries()]):t,a.crit)){if(!n.has(s))throw new t1(`Extension Header Parameter "${s}" is not recognized`);if(void 0===i[s])throw new e(`Extension Header Parameter "${s}" is missing`);if(n.get(s)&&void 0===a[s])throw new e(`Extension Header Parameter "${s}" MUST be integrity protected`)}return new Set(a.crit)},ao=Symbol();class ad{constructor(e){if(!(e instanceof Uint8Array))throw TypeError("plaintext must be an instance of Uint8Array");this._plaintext=e}setKeyManagementParameters(e){if(this._keyManagementParameters)throw TypeError("setKeyManagementParameters can only be called once");return this._keyManagementParameters=e,this}setProtectedHeader(e){if(this._protectedHeader)throw TypeError("setProtectedHeader can only be called once");return this._protectedHeader=e,this}setSharedUnprotectedHeader(e){if(this._sharedUnprotectedHeader)throw TypeError("setSharedUnprotectedHeader can only be called once");return this._sharedUnprotectedHeader=e,this}setUnprotectedHeader(e){if(this._unprotectedHeader)throw TypeError("setUnprotectedHeader can only be called once");return this._unprotectedHeader=e,this}setAdditionalAuthenticatedData(e){return this._aad=e,this}setContentEncryptionKey(e){if(this._cek)throw TypeError("setContentEncryptionKey can only be called once");return this._cek=e,this}setInitializationVector(e){if(this._iv)throw TypeError("setInitializationVector can only be called once");return this._iv=e,this}async encrypt(e,t){let r,a,i,s,o,d,c;if(!this._protectedHeader&&!this._unprotectedHeader&&!this._sharedUnprotectedHeader)throw new t5("either setProtectedHeader, setUnprotectedHeader, or sharedUnprotectedHeader must be called before #encrypt()");if(!an(this._protectedHeader,this._unprotectedHeader,this._sharedUnprotectedHeader))throw new t5("JWE Protected, JWE Shared Unprotected and JWE Per-Recipient Header Parameter names must be disjoint");let l={...this._protectedHeader,...this._unprotectedHeader,...this._sharedUnprotectedHeader};if(as(t5,new Map,null==t?void 0:t.crit,this._protectedHeader,l),void 0!==l.zip){if(!this._protectedHeader||!this._protectedHeader.zip)throw new t5('JWE "zip" (Compression Algorithm) Header MUST be integrity protected');if("DEF"!==l.zip)throw new t1('Unsupported JWE "zip" (Compression Algorithm) Header Parameter value')}let{alg:u,enc:p}=l;if("string"!=typeof u||!u)throw new t5('JWE "alg" (Algorithm) Header Parameter missing or invalid');if("string"!=typeof p||!p)throw new t5('JWE "enc" (Encryption Algorithm) Header Parameter missing or invalid');if("dir"===u){if(this._cek)throw TypeError("setContentEncryptionKey cannot be called when using Direct Encryption")}else if("ECDH-ES"===u&&this._cek)throw TypeError("setContentEncryptionKey cannot be called when using Direct Key Agreement");{let i;({cek:a,encryptedKey:r,parameters:i}=await ai(u,p,e,this._cek,this._keyManagementParameters)),i&&(t&&ao in t?this._unprotectedHeader?this._unprotectedHeader={...this._unprotectedHeader,...i}:this.setUnprotectedHeader(i):this._protectedHeader?this._protectedHeader={...this._protectedHeader,...i}:this.setProtectedHeader(i))}if(this._iv||(this._iv=t9(p)),s=this._protectedHeader?tW.encode(n(JSON.stringify(this._protectedHeader))):tW.encode(""),this._aad?(o=n(this._aad),i=tB(s,tW.encode("."),tW.encode(o))):i=s,"DEF"===l.zip){let e=await ((null==t?void 0:t.deflateRaw)||rv)(this._plaintext);({ciphertext:d,tag:c}=await rf(p,e,a,this._iv,i))}else({ciphertext:d,tag:c}=await rf(p,this._plaintext,a,this._iv,i));let h={ciphertext:n(d),iv:n(this._iv),tag:n(c)};return r&&(h.encrypted_key=n(r)),o&&(h.aad=o),this._protectedHeader&&(h.protected=tL.decode(s)),this._sharedUnprotectedHeader&&(h.unprotected=this._sharedUnprotectedHeader),this._unprotectedHeader&&(h.header=this._unprotectedHeader),h}}class ac{constructor(e){this._flattened=new ad(e)}setContentEncryptionKey(e){return this._flattened.setContentEncryptionKey(e),this}setInitializationVector(e){return this._flattened.setInitializationVector(e),this}setProtectedHeader(e){return this._flattened.setProtectedHeader(e),this}setKeyManagementParameters(e){return this._flattened.setKeyManagementParameters(e),this}async encrypt(e,t){let r=await this._flattened.encrypt(e,t);return[r.protected,r.encrypted_key,r.iv,r.ciphertext,r.tag].join(".")}}let al=e=>Math.floor(e.getTime()/1e3);function au(e){if("object"!=typeof e||null===e||"[object Object]"!==Object.prototype.toString.call(e))return!1;if(null===Object.getPrototypeOf(e))return!0;let t=e;for(;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}let ap=/^(\d+|\d+\.\d+) ?(seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)$/i,ah=e=>{let t=ap.exec(e);if(!t)throw TypeError("Invalid time period format");let r=parseFloat(t[1]);switch(t[2].toLowerCase()){case"sec":case"secs":case"second":case"seconds":case"s":return Math.round(r);case"minute":case"minutes":case"min":case"mins":case"m":return Math.round(60*r);case"hour":case"hours":case"hr":case"hrs":case"h":return Math.round(3600*r);case"day":case"days":case"d":return Math.round(86400*r);case"week":case"weeks":case"w":return Math.round(604800*r);default:return Math.round(0x1e187e0*r)}};class af{constructor(e){if(!au(e))throw TypeError("JWT Claims Set MUST be an object");this._payload=e}setIssuer(e){return this._payload={...this._payload,iss:e},this}setSubject(e){return this._payload={...this._payload,sub:e},this}setAudience(e){return this._payload={...this._payload,aud:e},this}setJti(e){return this._payload={...this._payload,jti:e},this}setNotBefore(e){return"number"==typeof e?this._payload={...this._payload,nbf:e}:this._payload={...this._payload,nbf:al(new Date)+ah(e)},this}setExpirationTime(e){return"number"==typeof e?this._payload={...this._payload,exp:e}:this._payload={...this._payload,exp:al(new Date)+ah(e)},this}setIssuedAt(e){return void 0===e?this._payload={...this._payload,iat:al(new Date)}:this._payload={...this._payload,iat:e},this}}class am extends af{setProtectedHeader(e){if(this._protectedHeader)throw TypeError("setProtectedHeader can only be called once");return this._protectedHeader=e,this}setKeyManagementParameters(e){if(this._keyManagementParameters)throw TypeError("setKeyManagementParameters can only be called once");return this._keyManagementParameters=e,this}setContentEncryptionKey(e){if(this._cek)throw TypeError("setContentEncryptionKey can only be called once");return this._cek=e,this}setInitializationVector(e){if(this._iv)throw TypeError("setInitializationVector can only be called once");return this._iv=e,this}replicateIssuerAsHeader(){return this._replicateIssuerAsHeader=!0,this}replicateSubjectAsHeader(){return this._replicateSubjectAsHeader=!0,this}replicateAudienceAsHeader(){return this._replicateAudienceAsHeader=!0,this}async encrypt(e,t){let r=new ac(tW.encode(JSON.stringify(this._payload)));return this._replicateIssuerAsHeader&&(this._protectedHeader={...this._protectedHeader,iss:this._payload.iss}),this._replicateSubjectAsHeader&&(this._protectedHeader={...this._protectedHeader,sub:this._payload.sub}),this._replicateAudienceAsHeader&&(this._protectedHeader={...this._protectedHeader,aud:this._payload.aud}),r.setProtectedHeader(this._protectedHeader),this._iv&&r.setInitializationVector(this._iv),this._cek&&r.setContentEncryptionKey(this._cek),this._keyManagementParameters&&r.setKeyManagementParameters(this._keyManagementParameters),r.encrypt(e,t)}}let ay=tM.Buffer.from([0]),ag=tM.Buffer.from([2]),a_=tM.Buffer.from([3]),av=tM.Buffer.from([48]),aw=tM.Buffer.from([4]),aE=e=>{if(e<128)return tM.Buffer.from([e]);let t=tM.Buffer.alloc(5);t.writeUInt32BE(e,1);let r=1;for(;0===t[r];)r++;return t[r-1]=128|5-r,t.slice(r-1)},ab=new Map([["P-256",tM.Buffer.from("06 08 2A 86 48 CE 3D 03 01 07".replace(/ /g,""),"hex")],["secp256k1",tM.Buffer.from("06 05 2B 81 04 00 0A".replace(/ /g,""),"hex")],["P-384",tM.Buffer.from("06 05 2B 81 04 00 22".replace(/ /g,""),"hex")],["P-521",tM.Buffer.from("06 05 2B 81 04 00 23".replace(/ /g,""),"hex")],["ecPublicKey",tM.Buffer.from("06 07 2A 86 48 CE 3D 02 01".replace(/ /g,""),"hex")],["X25519",tM.Buffer.from("06 03 2B 65 6E".replace(/ /g,""),"hex")],["X448",tM.Buffer.from("06 03 2B 65 6F".replace(/ /g,""),"hex")],["Ed25519",tM.Buffer.from("06 03 2B 65 70".replace(/ /g,""),"hex")],["Ed448",tM.Buffer.from("06 03 2B 65 71".replace(/ /g,""),"hex")]]);class ak{constructor(){this.length=0,this.elements=[]}oidFor(e){let t=ab.get(e);if(!t)throw new t1("Invalid or unsupported OID");this.elements.push(t),this.length+=t.length}zero(){this.elements.push(ag,tM.Buffer.from([1]),ay),this.length+=3}one(){this.elements.push(ag,tM.Buffer.from([1]),tM.Buffer.from([1])),this.length+=3}unsignedInteger(e){if(128&e[0]){let t=aE(e.length+1);this.elements.push(ag,t,ay,e),this.length+=2+t.length+e.length}else{let t=0;for(;0===e[t]&&(128&e[t+1])==0;)t++;let r=aE(e.length-t);this.elements.push(ag,aE(e.length-t),e.slice(t)),this.length+=1+r.length+e.length-t}}octStr(e){let t=aE(e.length);this.elements.push(aw,aE(e.length),e),this.length+=1+t.length+e.length}bitStr(e){let t=aE(e.length+1);this.elements.push(a_,aE(e.length+1),ay,e),this.length+=1+t.length+e.length+1}add(e){this.elements.push(e),this.length+=e.length}end(e=av){let t=aE(this.length);return tM.Buffer.concat([e,t,...this.elements],1+t.length+this.length)}}let ax=e=>{if(r5&&"oct"!==e.kty)return e.d?(0,tU.createPrivateKey)({format:"jwk",key:e}):(0,tU.createPublicKey)({format:"jwk",key:e});switch(e.kty){case"oct":return(0,tU.createSecretKey)(tq(e.k));case"RSA":{let t=new ak,r=void 0!==e.d,a=tM.Buffer.from(e.n,"base64"),i=tM.Buffer.from(e.e,"base64");r?(t.zero(),t.unsignedInteger(a),t.unsignedInteger(i),t.unsignedInteger(tM.Buffer.from(e.d,"base64")),t.unsignedInteger(tM.Buffer.from(e.p,"base64")),t.unsignedInteger(tM.Buffer.from(e.q,"base64")),t.unsignedInteger(tM.Buffer.from(e.dp,"base64")),t.unsignedInteger(tM.Buffer.from(e.dq,"base64")),t.unsignedInteger(tM.Buffer.from(e.qi,"base64"))):(t.unsignedInteger(a),t.unsignedInteger(i));let n={key:t.end(),format:"der",type:"pkcs1"},s=r?(0,tU.createPrivateKey)(n):(0,tU.createPublicKey)(n);return rB(s,a.length<<3),s}case"EC":{var t,r;let a=new ak,i=void 0!==e.d,n=tM.Buffer.concat([tM.Buffer.alloc(1,4),tM.Buffer.from(e.x,"base64"),tM.Buffer.from(e.y,"base64")]);if(i){a.zero();let r=new ak;r.oidFor("ecPublicKey"),r.oidFor(e.crv),a.add(r.end());let i=new ak;i.one(),i.octStr(tM.Buffer.from(e.d,"base64"));let s=new ak;s.bitStr(n);let o=s.end(tM.Buffer.from([161]));i.add(o);let d=i.end(),c=new ak;c.add(d);let l=c.end(tM.Buffer.from([4]));a.add(l);let u=a.end(),p=(0,tU.createPrivateKey)({key:u,format:"der",type:"pkcs8"});return t=e.crv,rO.set(p,t),p}let s=new ak;s.oidFor("ecPublicKey"),s.oidFor(e.crv),a.add(s.end()),a.bitStr(n);let o=a.end(),d=(0,tU.createPublicKey)({key:o,format:"der",type:"spki"});return r=e.crv,rO.set(d,r),d}case"OKP":{let t=new ak;if(void 0!==e.d){t.zero();let r=new ak;r.oidFor(e.crv),t.add(r.end());let a=new ak;a.octStr(tM.Buffer.from(e.d,"base64"));let i=a.end(tM.Buffer.from([4]));t.add(i);let n=t.end();return(0,tU.createPrivateKey)({key:n,format:"der",type:"pkcs8"})}let r=new ak;r.oidFor(e.crv),t.add(r.end()),t.bitStr(tM.Buffer.from(e.x,"base64"));let a=t.end();return(0,tU.createPublicKey)({key:a,format:"der",type:"spki"})}default:throw new t1('Invalid or unsupported JWK "kty" (Key Type) Parameter value')}};async function aA(e,t,r){var a;if(!au(e))throw TypeError("JWK must be an object");switch(t||(t=e.alg),e.kty){case"oct":if("string"!=typeof e.k||!e.k)throw TypeError('missing "k" (Key Value) Parameter value');if(null!=r||(r=!0!==e.ext),r)return ax({...e,alg:t,ext:null!=(a=e.ext)&&a});return tq(e.k);case"RSA":if(void 0!==e.oth)throw new t1('RSA JWK "oth" (Other Primes Info) Parameter value is not supported');case"EC":case"OKP":return ax({...e,alg:t});default:throw new t1('Unsupported "kty" (Key Type) Parameter value')}}async function aS(e,t,r,a,i){switch(r7(e,t,"decrypt"),e){case"dir":if(void 0!==r)throw new t5("Encountered unexpected JWE Encrypted Key");return t;case"ECDH-ES":if(void 0!==r)throw new t5("Encountered unexpected JWE Encrypted Key");case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":{let i,n;if(!au(a.epk))throw new t5('JOSE Header "epk" (Ephemeral Public Key) missing or invalid');if(!rj(t))throw new t1("ECDH with the provided key is not allowed or not supported by your javascript runtime");let s=await aA(a.epk,e);if(void 0!==a.apu){if("string"!=typeof a.apu)throw new t5('JOSE Header "apu" (Agreement PartyUInfo) invalid');try{i=tq(a.apu)}catch{throw new t5("Failed to base64url decode the apu")}}if(void 0!==a.apv){if("string"!=typeof a.apv)throw new t5('JOSE Header "apv" (Agreement PartyVInfo) invalid');try{n=tq(a.apv)}catch{throw new t5("Failed to base64url decode the apv")}}let o=await rI(s,t,"ECDH-ES"===e?a.enc:e,"ECDH-ES"===e?rX(a.enc):parseInt(e.slice(-5,-2),10),i,n);if("ECDH-ES"===e)return o;if(void 0===r)throw new t5("JWE Encrypted Key missing");return rk(e.slice(-6),o,r)}case"RSA1_5":case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":if(void 0===r)throw new t5("JWE Encrypted Key missing");return rY(e,t,r);case"PBES2-HS256+A128KW":case"PBES2-HS384+A192KW":case"PBES2-HS512+A256KW":{let n;if(void 0===r)throw new t5("JWE Encrypted Key missing");if("number"!=typeof a.p2c)throw new t5('JOSE Header "p2c" (PBES2 Count) missing or invalid');let s=(null==i?void 0:i.maxPBES2Count)||1e4;if(a.p2c>s)throw new t5('JOSE Header "p2c" (PBES2 Count) out is of acceptable bounds');if("string"!=typeof a.p2s)throw new t5('JOSE Header "p2s" (PBES2 Salt) missing or invalid');try{n=tq(a.p2s)}catch{throw new t5("Failed to base64url decode the p2s")}return rH(e,t,r,a.p2c,n)}case"A128KW":case"A192KW":case"A256KW":if(void 0===r)throw new t5("JWE Encrypted Key missing");return rk(e,t,r);case"A128GCMKW":case"A192GCMKW":case"A256GCMKW":{let i,n;if(void 0===r)throw new t5("JWE Encrypted Key missing");if("string"!=typeof a.iv)throw new t5('JOSE Header "iv" (Initialization Vector) missing or invalid');if("string"!=typeof a.tag)throw new t5('JOSE Header "tag" (Authentication Tag) missing or invalid');try{i=tq(a.iv)}catch{throw new t5("Failed to base64url decode the iv")}try{n=tq(a.tag)}catch{throw new t5("Failed to base64url decode the tag")}return aa(e,t,r,i,n)}default:throw new t1('Invalid or unsupported "alg" (JWE Algorithm) header value')}}let aT=(e,t)=>{if(void 0!==t&&(!Array.isArray(t)||t.some(e=>"string"!=typeof e)))throw TypeError(`"${e}" option must be an array of strings`);if(t)return new Set(t)};async function aO(e,t,r){var a;let i,n,s,o,d,c,l;if(!au(e))throw new t5("Flattened JWE must be an object");if(void 0===e.protected&&void 0===e.header&&void 0===e.unprotected)throw new t5("JOSE Header missing");if("string"!=typeof e.iv)throw new t5("JWE Initialization Vector missing or incorrect type");if("string"!=typeof e.ciphertext)throw new t5("JWE Ciphertext missing or incorrect type");if("string"!=typeof e.tag)throw new t5("JWE Authentication Tag missing or incorrect type");if(void 0!==e.protected&&"string"!=typeof e.protected)throw new t5("JWE Protected Header incorrect type");if(void 0!==e.encrypted_key&&"string"!=typeof e.encrypted_key)throw new t5("JWE Encrypted Key incorrect type");if(void 0!==e.aad&&"string"!=typeof e.aad)throw new t5("JWE AAD incorrect type");if(void 0!==e.header&&!au(e.header))throw new t5("JWE Shared Unprotected Header incorrect type");if(void 0!==e.unprotected&&!au(e.unprotected))throw new t5("JWE Per-Recipient Unprotected Header incorrect type");if(e.protected)try{let t=tq(e.protected);i=JSON.parse(tL.decode(t))}catch{throw new t5("JWE Protected Header is invalid")}if(!an(i,e.header,e.unprotected))throw new t5("JWE Protected, JWE Unprotected Header, and JWE Per-Recipient Unprotected Header Parameter names must be disjoint");let u={...i,...e.header,...e.unprotected};if(as(t5,new Map,null==r?void 0:r.crit,i,u),void 0!==u.zip){if(!i||!i.zip)throw new t5('JWE "zip" (Compression Algorithm) Header MUST be integrity protected');if("DEF"!==u.zip)throw new t1('Unsupported JWE "zip" (Compression Algorithm) Header Parameter value')}let{alg:p,enc:h}=u;if("string"!=typeof p||!p)throw new t5("missing JWE Algorithm (alg) in JWE Header");if("string"!=typeof h||!h)throw new t5("missing JWE Encryption Algorithm (enc) in JWE Header");let f=r&&aT("keyManagementAlgorithms",r.keyManagementAlgorithms),m=r&&aT("contentEncryptionAlgorithms",r.contentEncryptionAlgorithms);if(f&&!f.has(p))throw new t0('"alg" (Algorithm) Header Parameter not allowed');if(m&&!m.has(h))throw new t0('"enc" (Encryption Algorithm) Header Parameter not allowed');if(void 0!==e.encrypted_key)try{n=tq(e.encrypted_key)}catch{throw new t5("Failed to base64url decode the encrypted_key")}let y=!1;"function"==typeof t&&(t=await t(i,e),y=!0);try{s=await aS(p,t,n,u,r)}catch(e){if(e instanceof TypeError||e instanceof t5||e instanceof t1)throw e;s=rQ(h)}try{o=tq(e.iv)}catch{throw new t5("Failed to base64url decode the iv")}try{d=tq(e.tag)}catch{throw new t5("Failed to base64url decode the tag")}let g=tW.encode(null!=(a=e.protected)?a:"");c=void 0!==e.aad?tB(g,tW.encode("."),tW.encode(e.aad)):g;try{l=tq(e.ciphertext)}catch{throw new t5("Failed to base64url decode the ciphertext")}let _=await at(h,s,l,o,d,c);"DEF"===u.zip&&(_=await ((null==r?void 0:r.inflateRaw)||r_)(_));let v={plaintext:_};if(void 0!==e.protected&&(v.protectedHeader=i),void 0!==e.aad)try{v.additionalAuthenticatedData=tq(e.aad)}catch{throw new t5("Failed to base64url decode the aad")}return(void 0!==e.unprotected&&(v.sharedUnprotectedHeader=e.unprotected),void 0!==e.header&&(v.unprotectedHeader=e.header),y)?{...v,key:t}:v}async function aC(e,t,r){if(e instanceof Uint8Array&&(e=tL.decode(e)),"string"!=typeof e)throw new t5("Compact JWE must be a string or Uint8Array");let{0:a,1:i,2:n,3:s,4:o,length:d}=e.split(".");if(5!==d)throw new t5("Invalid Compact JWE");let c=await aO({ciphertext:s,iv:n||void 0,protected:a||void 0,tag:o||void 0,encrypted_key:i||void 0},t,r),l={plaintext:c.plaintext,protectedHeader:c.protectedHeader};return"function"==typeof t?{...l,key:c.key}:l}let aR=e=>e.toLowerCase().replace(/^application\//,""),aP=(e,t)=>"string"==typeof e?t.includes(e):!!Array.isArray(e)&&t.some(Set.prototype.has.bind(new Set(e))),aI=(e,t,r={})=>{let a,i,{typ:n}=r;if(n&&("string"!=typeof e.typ||aR(e.typ)!==aR(n)))throw new tX('unexpected "typ" JWT header value',"typ","check_failed");try{a=JSON.parse(tL.decode(t))}catch{}if(!au(a))throw new t8("JWT Claims Set must be a top-level JSON object");let{requiredClaims:s=[],issuer:o,subject:d,audience:c,maxTokenAge:l}=r;for(let e of(void 0!==l&&s.push("iat"),void 0!==c&&s.push("aud"),void 0!==d&&s.push("sub"),void 0!==o&&s.push("iss"),new Set(s.reverse())))if(!(e in a))throw new tX(`missing required "${e}" claim`,e,"missing");if(o&&!(Array.isArray(o)?o:[o]).includes(a.iss))throw new tX('unexpected "iss" claim value',"iss","check_failed");if(d&&a.sub!==d)throw new tX('unexpected "sub" claim value',"sub","check_failed");if(c&&!aP(a.aud,"string"==typeof c?[c]:c))throw new tX('unexpected "aud" claim value',"aud","check_failed");switch(typeof r.clockTolerance){case"string":i=ah(r.clockTolerance);break;case"number":i=r.clockTolerance;break;case"undefined":i=0;break;default:throw TypeError("Invalid clockTolerance option type")}let{currentDate:u}=r,p=al(u||new Date);if((void 0!==a.iat||l)&&"number"!=typeof a.iat)throw new tX('"iat" claim must be a number',"iat","invalid");if(void 0!==a.nbf){if("number"!=typeof a.nbf)throw new tX('"nbf" claim must be a number',"nbf","invalid");if(a.nbf>p+i)throw new tX('"nbf" claim timestamp check failed',"nbf","check_failed")}if(void 0!==a.exp){if("number"!=typeof a.exp)throw new tX('"exp" claim must be a number',"exp","invalid");if(a.exp<=p-i)throw new tQ('"exp" claim timestamp check failed',"exp","check_failed")}if(l){let e=p-a.iat;if(e-i>("number"==typeof l?l:ah(l)))throw new tQ('"iat" claim timestamp check failed (too far in the past)',"iat","check_failed");if(e<0-i)throw new tX('"iat" claim timestamp check failed (it should be in the past)',"iat","check_failed")}return a};async function aU(e,t,r){let a=await aC(e,t,r),i=aI(a.protectedHeader,a.plaintext,r),{protectedHeader:n}=a;if(void 0!==n.iss&&n.iss!==i.iss)throw new tX('replicated "iss" claim header parameter mismatch',"iss","mismatch");if(void 0!==n.sub&&n.sub!==i.sub)throw new tX('replicated "sub" claim header parameter mismatch',"sub","mismatch");if(void 0!==n.aud&&JSON.stringify(n.aud)!==JSON.stringify(i.aud))throw new tX('replicated "aud" claim header parameter mismatch',"aud","mismatch");let s={payload:i,protectedHeader:n};return"function"==typeof t?{...s,key:a.key}:s}let aj={randomUUID:tj().randomUUID},aZ=new Uint8Array(256),aN=aZ.length,aK=[];for(let e=0;e<256;++e)aK.push((e+256).toString(16).slice(1));let aD=function(e,t,r){if(aj.randomUUID&&!t&&!e)return aj.randomUUID();let a=(e=e||{}).random||(e.rng||function(){return aN>aZ.length-16&&(tj().randomFillSync(aZ),aN=0),aZ.slice(aN,aN+=16)})();if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,t){r=r||0;for(let e=0;e<16;++e)t[r+e]=a[e];return t}return function(e,t=0){return aK[e[t+0]]+aK[e[t+1]]+aK[e[t+2]]+aK[e[t+3]]+"-"+aK[e[t+4]]+aK[e[t+5]]+"-"+aK[e[t+6]]+aK[e[t+7]]+"-"+aK[e[t+8]]+aK[e[t+9]]+"-"+aK[e[t+10]]+aK[e[t+11]]+aK[e[t+12]]+aK[e[t+13]]+aK[e[t+14]]+aK[e[t+15]]}(a)},aH=["image/jpeg","image/png","image/gif","image/webp","image/svg+xml","image/tiff","image/bmp","image/x-icon"];async function aM(e){let t=globalThis._EDGE_STORE_LOGGER,{ctx:r,provider:a,router:i}=e;t.debug("Running [init]",{ctx:r});let n=await aJ(r),{token:s}=await a.init({ctx:r,router:i}),o=[(0,tH.l)("edgestore-ctx",n,{path:"/",maxAge:2592e3})];s&&o.push((0,tH.l)("edgestore-token",s,{path:"/",maxAge:2592e3}));let d=await a.getBaseUrl();return t.debug("Finished [init]",{ctx:r,newCookies:o,token:s,baseUrl:d}),{newCookies:o,token:s,baseUrl:d}}async function a$(e){var t;let{provider:r,router:a,ctxToken:i,body:{bucketName:n,input:s,fileInfo:o}}=e,d=globalThis._EDGE_STORE_LOGGER;if(d.debug("Running [requestUpload]",{bucketName:n,input:s,fileInfo:o}),!i)throw new tv({message:"Missing edgestore-ctx cookie",code:"UNAUTHORIZED"});let c=await aV(i);d.debug("Decrypted Context",{ctx:c});let l=a.buckets[n];if(!l)throw new tv({message:`Bucket ${n} not found`,code:"BAD_REQUEST"});if(l._def.beforeUpload){d.debug("Running [beforeUpload]");let e=await l._def.beforeUpload?.({ctx:c,input:s,fileInfo:{size:o.size,type:o.type,fileName:o.fileName,extension:o.extension,replaceTargetUrl:o.replaceTargetUrl,temporary:o.temporary}});if(d.debug("Finished [beforeUpload]",{canUpload:e}),!e)throw new tv({message:"Upload not allowed for the current context",code:"UPLOAD_NOT_ALLOWED"})}if("IMAGE"===l._def.type&&!aH.includes(o.type))throw new tv({code:"MIME_TYPE_NOT_ALLOWED",message:"Only images are allowed in this bucket",details:{allowedMimeTypes:aH,mimeType:o.type}});if(l._def.bucketConfig?.maxSize&&o.size>l._def.bucketConfig.maxSize)throw new tv({code:"FILE_TOO_LARGE",message:`File size is too big. Max size is ${l._def.bucketConfig.maxSize}`,details:{maxFileSize:l._def.bucketConfig.maxSize,fileSize:o.size}});if(l._def.bucketConfig?.accept){let e=l._def.bucketConfig.accept,t=!1;for(let r of e)if(r.endsWith("/*")){let e=r.replace("/*","");if(o.type.startsWith(e)){t=!0;break}}else if(o.type===r){t=!0;break}if(!t)throw new tv({code:"MIME_TYPE_NOT_ALLOWED",message:`"${o.type}" is not allowed. Accepted types are ${JSON.stringify(e)}`,details:{allowedMimeTypes:e,mimeType:o.type}})}let u=function(e){let{bucket:t}=e,r=t._def.path;return r.map(t=>{let a=Object.entries(t);if(void 0===a[0])throw new tv({message:`Empty path param found in: ${JSON.stringify(r)}`,code:"SERVER_ERROR"});let[i,n]=a[0];return{key:i,value:n().split(".").reduce((e,t)=>{if(void 0===e[t])throw new tv({message:`Missing key ${t} in ${JSON.stringify(e)}`,code:"BAD_REQUEST"});return e[t]},e.pathAttrs)}})}({fileInfo:o,bucket:l,pathAttrs:{ctx:c,input:s}}),p=await l._def.metadata?.({ctx:c,input:s}),h=void 0===l._def.accessControl;d.debug("upload info",{path:u,metadata:p,isPublic:h,bucketType:l._def.type});let f=await r.requestUpload({bucketName:n,bucketType:l._def.type,fileInfo:{...o,path:u,isPublic:h,metadata:p}}),{parsedPath:m,pathOrder:y}={parsedPath:(t=u).reduce((e,t)=>(e[t.key]=t.value,e),{}),pathOrder:t.map(e=>e.key)};return d.debug("Finished [requestUpload]"),{...f,size:o.size,uploadedAt:new Date().toISOString(),path:m,pathOrder:y,metadata:p}}async function aW(e){let{provider:t,ctxToken:r,body:{multipart:a,path:i}}=e,n=globalThis._EDGE_STORE_LOGGER;if(n.debug("Running [requestUploadParts]",{multipart:a,path:i}),!r)throw new tv({message:"Missing edgestore-ctx cookie",code:"UNAUTHORIZED"});await aV(r);let s=await t.requestUploadParts({multipart:a,path:i});return n.debug("Finished [requestUploadParts]"),s}async function aL(e){let{provider:t,router:r,ctxToken:a,body:{bucketName:i,uploadId:n,key:s,parts:o}}=e,d=globalThis._EDGE_STORE_LOGGER;if(d.debug("Running [completeMultipartUpload]",{bucketName:i,uploadId:n,key:s}),!a)throw new tv({message:"Missing edgestore-ctx cookie",code:"UNAUTHORIZED"});if(await aV(a),!r.buckets[i])throw new tv({message:`Bucket ${i} not found`,code:"BAD_REQUEST"});let c=await t.completeMultipartUpload({uploadId:n,key:s,parts:o});return d.debug("Finished [completeMultipartUpload]"),c}async function aB(e){let{provider:t,router:r,ctxToken:a,body:{bucketName:i,url:n}}=e,s=globalThis._EDGE_STORE_LOGGER;if(s.debug("Running [confirmUpload]",{bucketName:i,url:n}),!a)throw new tv({message:"Missing edgestore-ctx cookie",code:"UNAUTHORIZED"});await aV(a);let o=r.buckets[i];if(!o)throw new tv({message:`Bucket ${i} not found`,code:"BAD_REQUEST"});let d=await t.confirmUpload({bucket:o,url:n});return s.debug("Finished [confirmUpload]"),d}async function aF(e){let{provider:t,router:r,ctxToken:a,body:{bucketName:i,url:n}}=e,s=globalThis._EDGE_STORE_LOGGER;if(s.debug("Running [deleteFile]",{bucketName:i,url:n}),!a)throw new tv({message:"Missing edgestore-ctx cookie",code:"UNAUTHORIZED"});let o=await aV(a),d=r.buckets[i];if(!d)throw new tv({message:`Bucket ${i} not found`,code:"BAD_REQUEST"});if(!d._def.beforeDelete)throw new tv({message:"You need to define beforeDelete if you want to delete files directly from the frontend.",code:"SERVER_ERROR"});let c=await t.getFile({url:n});if(!await d._def.beforeDelete({ctx:o,fileInfo:c}))throw new tv({message:"Delete not allowed for the current context",code:"DELETE_NOT_ALLOWED"});let l=await t.deleteFile({bucket:d,url:n});return s.debug("Finished [deleteFile]"),l}async function aJ(e){let t=process.env.EDGE_STORE_JWT_SECRET??process.env.EDGE_STORE_SECRET_KEY;if(!t)throw new tv({message:"EDGE_STORE_JWT_SECRET or EDGE_STORE_SECRET_KEY is not defined",code:"SERVER_ERROR"});let r=await aG(t);return await new am(e).setProtectedHeader({alg:"dir",enc:"A256GCM"}).setIssuedAt().setExpirationTime(Date.now()/1e3+2592e3).setJti(aD()).encrypt(r)}async function az(e){let t=process.env.EDGE_STORE_JWT_SECRET??process.env.EDGE_STORE_SECRET_KEY;if(!t)throw new tv({message:"EDGE_STORE_JWT_SECRET or EDGE_STORE_SECRET_KEY is not defined",code:"SERVER_ERROR"});let r=await aG(t),{payload:a}=await aU(e,r,{clockTolerance:15});return a}async function aG(e){return await tD("sha256",e,"","Edge Store Generated Encryption Key",32)}async function aV(e){return await az(e)}let aq=tx.create(),aY=function(e){let{provider:t=function(e){let{accessKey:t=process.env.EDGE_STORE_ACCESS_KEY,secretKey:r=process.env.EDGE_STORE_SECRET_KEY}=(void 0)??{},a=process.env.EDGE_STORE_BASE_URL??"https://files.edgestore.dev";if(!t||!r)throw new tC;let i=function(e){let{accessKey:t=process.env.EDGE_STORE_ACCESS_KEY,secretKey:r=process.env.EDGE_STORE_SECRET_KEY}=e??{};if(!t||!r)throw new tC;return{getToken:async e=>await tI.getToken({accessKey:t,secretKey:r,ctx:e.ctx,router:e.router}),getFile:async({url:e})=>await tI.getFile({accessKey:t,secretKey:r,url:e}),requestUpload:async({bucketName:e,bucketType:a,fileInfo:i,multipart:n})=>await tI.requestUpload({accessKey:t,secretKey:r,bucketName:e,bucketType:a,fileInfo:i,multipart:n}),requestUploadParts:async({key:e,multipart:a})=>await tI.requestUploadParts({accessKey:t,secretKey:r,key:e,multipart:a}),completeMultipartUpload:async({uploadId:e,key:a,parts:i})=>await tI.completeMultipartUpload({accessKey:t,secretKey:r,uploadId:e,key:a,parts:i}),confirmUpload:async({url:e})=>await tI.confirmUpload({accessKey:t,secretKey:r,url:e}),deleteFile:async({url:e})=>await tI.deleteFile({accessKey:t,secretKey:r,url:e}),listFiles:async e=>await tI.listFiles({accessKey:t,secretKey:r,...e})}}({accessKey:t,secretKey:r});return{init:async({ctx:e,router:t})=>({token:await i.getToken({ctx:e,router:t})}),getBaseUrl:()=>a,getFile:async({url:e})=>{let{uploadedAt:t,...r}=await i.getFile({url:e});return{uploadedAt:new Date(t),...r}},async requestUpload({bucketName:e,bucketType:t,fileInfo:r}){let a=5242880;if(r.size>0xa00000){let n=Math.ceil(r.size/a);n>1e3&&(n=1e3,a=Math.ceil(r.size/n));let s=await i.requestUpload({bucketName:e,bucketType:t,fileInfo:r,multipart:{parts:Array.from({length:n}).map((e,t)=>t+1)}}),o=s.multipart?{key:s.multipart.key,uploadId:s.multipart.uploadId,parts:s.multipart.parts.map(e=>({partNumber:e.partNumber,uploadUrl:e.signedUrl})),partSize:a,totalParts:n}:void 0;if(o)return{accessUrl:s.accessUrl,thumbnailUrl:s.thumbnailUrl,multipart:o};if(s.signedUrl)return{accessUrl:s.accessUrl,uploadUrl:s.signedUrl,thumbnailUrl:s.thumbnailUrl};throw new tv({message:"Could not get upload url",code:"SERVER_ERROR"})}let n=await i.requestUpload({bucketName:e,bucketType:t,fileInfo:r});if(n.signedUrl)return{accessUrl:n.accessUrl,uploadUrl:n.signedUrl,thumbnailUrl:n.thumbnailUrl};throw new tv({message:"Could not get upload url",code:"SERVER_ERROR"})},requestUploadParts:async({multipart:e,path:t})=>{let r=await i.requestUploadParts({multipart:e,key:t});return{multipart:{uploadId:r.multipart.uploadId,parts:r.multipart.parts.map(e=>({partNumber:e.partNumber,uploadUrl:e.signedUrl}))}}},completeMultipartUpload:async({uploadId:e,key:t,parts:r})=>await i.completeMultipartUpload({uploadId:e,key:t,parts:r}),confirmUpload:async({url:e})=>await i.confirmUpload({url:e}),deleteFile:async({url:e})=>await i.deleteFile({url:e})}}()}=e,r=new tS(e.logLevel);return globalThis._EDGE_STORE_LOGGER=r,r.debug("Creating Edge Store Next handler (app adapter)"),async a=>{try{if(!("nextUrl"in a))throw new tv({message:"Error running the app adapter. Make sure you are importing the correct adapter in your router configuration",code:"SERVER_ERROR"});let r=a.nextUrl.pathname;if(tT(r,"/health"))return new Response("OK",{status:200});if(tT(r,"/init")){let r={};try{r="createContext"in e?await e.createContext({req:a}):{}}catch(e){throw new tv({message:"Error creating context",code:"CREATE_CONTEXT_ERROR",cause:e instanceof Error?e:void 0})}let{newCookies:i,token:n,baseUrl:s}=await aM({ctx:r,provider:t,router:e.router}),o=new Response(JSON.stringify({token:n,baseUrl:s}),{status:200,headers:{"Content-Type":"application/json"}});for(let e of i)o.headers.append("Set-Cookie",e);return o}if(tT(r,"/request-upload")){let r=await a$({provider:t,router:e.router,body:await a.json(),ctxToken:a.cookies.get("edgestore-ctx")?.value});return new Response(JSON.stringify(r),{status:200,headers:{"Content-Type":"application/json"}})}else if(tT(r,"/request-upload-parts")){let r=await aW({provider:t,router:e.router,body:await a.json(),ctxToken:a.cookies.get("edgestore-ctx")?.value});return new Response(JSON.stringify(r),{status:200,headers:{"Content-Type":"application/json"}})}else if(tT(r,"/complete-multipart-upload"))return await aL({provider:t,router:e.router,body:await a.json(),ctxToken:a.cookies.get("edgestore-ctx")?.value}),new Response(null,{status:200});else if(tT(r,"/confirm-upload")){let r=await aB({provider:t,router:e.router,body:await a.json(),ctxToken:a.cookies.get("edgestore-ctx")?.value});return new Response(JSON.stringify(r),{status:200,headers:{"Content-Type":"application/json"}})}else if(tT(r,"/delete-file")){let r=await aF({provider:t,router:e.router,body:await a.json(),ctxToken:a.cookies.get("edgestore-ctx")?.value});return new Response(JSON.stringify(r),{status:200,headers:{"Content-Type":"application/json"}})}else{if(!tT(r,"/proxy-file"))return new Response(null,{status:404});let e=a.nextUrl.searchParams.get("url");if("string"!=typeof e)return new Response(null,{status:400});{let t=await fetch(e,{headers:{cookie:a.cookies.toString()??""}}),r=await t.arrayBuffer();return new Response(r,{status:t.status,headers:{"Content-Type":t.headers.get("Content-Type")??"application/octet-stream"}})}}}catch(e){if(e instanceof tv)return r[e.level](e.formattedMessage()),e.cause&&r[e.level](e.cause),new Response(JSON.stringify(e.formattedJson()),{status:t_[e.code],headers:{"Content-Type":"application/json"}});return r.error(e),new Response(JSON.stringify(new tv({message:"Internal server error",code:"SERVER_ERROR"}).formattedJson()),{status:500,headers:{"Content-Type":"application/json"}})}}}({router:aq.router({publicFiles:aq.fileBucket()})}),aX=new f.AppRouteRouteModule({definition:{kind:m.RouteKind.APP_ROUTE,page:"/api/edgestore/[...edgestore]/route",pathname:"/api/edgestore/[...edgestore]",filename:"route",bundlePath:"app/api/edgestore/[...edgestore]/route"},resolvedPagePath:"C:\\Users\\Russell\\Downloads\\AI-Projects\\Mesza\\mesza-app\\app\\api\\edgestore\\[...edgestore]\\route.ts",nextConfigOutput:"",userland:h}),{workAsyncStorage:aQ,workUnitAsyncStorage:a0,serverHooks:a1}=aX;function a2(){return(0,y.patchFetch)({workAsyncStorage:aQ,workUnitAsyncStorage:a0})}},93807:(e,t)=>{"use strict";t.l=function(e,t,i){var s=i||{},o=s.encode||n;if("function"!=typeof o)throw TypeError("option encode is invalid");if(!a.test(e))throw TypeError("argument name is invalid");var d=o(t);if(d&&!a.test(d))throw TypeError("argument val is invalid");var c=e+"="+d;if(null!=s.maxAge){var l=s.maxAge-0;if(isNaN(l)||!isFinite(l))throw TypeError("option maxAge is invalid");c+="; Max-Age="+Math.floor(l)}if(s.domain){if(!a.test(s.domain))throw TypeError("option domain is invalid");c+="; Domain="+s.domain}if(s.path){if(!a.test(s.path))throw TypeError("option path is invalid");c+="; Path="+s.path}if(s.expires){var u,p=s.expires;if(u=p,"[object Date]"!==r.call(u)&&!(u instanceof Date)||isNaN(p.valueOf()))throw TypeError("option expires is invalid");c+="; Expires="+p.toUTCString()}if(s.httpOnly&&(c+="; HttpOnly"),s.secure&&(c+="; Secure"),s.priority)switch("string"==typeof s.priority?s.priority.toLowerCase():s.priority){case"low":c+="; Priority=Low";break;case"medium":c+="; Priority=Medium";break;case"high":c+="; Priority=High";break;default:throw TypeError("option priority is invalid")}if(s.sameSite)switch("string"==typeof s.sameSite?s.sameSite.toLowerCase():s.sameSite){case!0:case"strict":c+="; SameSite=Strict";break;case"lax":c+="; SameSite=Lax";break;case"none":c+="; SameSite=None";break;default:throw TypeError("option sameSite is invalid")}return c};var r=Object.prototype.toString,a=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/;function i(e){return -1!==e.indexOf("%")?decodeURIComponent(e):e}function n(e){return encodeURIComponent(e)}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[6862],()=>r(88549));module.exports=a})();